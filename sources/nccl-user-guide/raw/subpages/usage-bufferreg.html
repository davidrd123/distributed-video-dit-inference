<!DOCTYPE html>
<html class="writer-html5" lang="en-US">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Buffer Registration &mdash; NCCL 2.29.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=8eabb79f" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=324d1df1"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Device-Initiated Communication" href="deviceapi.html" />
    <link rel="prev" title="Using NCCL with CUDA Graphs" href="cudagraph.html" />
  <script src="https://assets.adobedtm.com/5d4962a43b79/c1061d2c5e7b/launch-191c2462b890.min.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" > 

          
          
          <a href="../index.html" class="icon icon-home">
            NCCL
          </a>
              <div class="version">
                <a href="https://docs.nvidia.com/deeplearning/sdk/nccl-archived/index.html">2.29</a>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #76b900;
    }
    .wy-side-nav-search a:link, .wy-nav-top a:link {
      color: #fff;
    }
    .wy-side-nav-search a:visited, .wy-nav-top a:visited {
      color: #fff;
    }
    .wy-side-nav-search a:hover, .wy-nav-top a:hover {
      color: #fff;
    }
    .wy-menu-vertical a:link, .wy-menu-vertical a:visited {
      color: #d9d9d9
    }
    .wy-menu-vertical a:active {
      background-color: #76b900
    }
    .wy-side-nav-search>div.version {
      color: rgba(0, 0, 0, 0.3)
    }
  </style>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview of NCCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../usage.html">Using NCCL</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="communicators.html">Creating a Communicator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="communicators.html#creating-a-communicator-with-options">Creating a communicator with options</a></li>
<li class="toctree-l3"><a class="reference internal" href="communicators.html#creating-a-communicator-using-multiple-nccluniqueids">Creating a communicator using multiple ncclUniqueIds</a></li>
<li class="toctree-l3"><a class="reference internal" href="communicators.html#shrinking-a-communicator">Shrinking a communicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="communicators.html#growing-a-communicator">Growing a communicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="communicators.html#creating-more-communicators">Creating more communicators</a></li>
<li class="toctree-l3"><a class="reference internal" href="communicators.html#using-multiple-nccl-communicators-concurrently">Using multiple NCCL communicators concurrently</a></li>
<li class="toctree-l3"><a class="reference internal" href="communicators.html#finalizing-a-communicator">Finalizing a communicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="communicators.html#destroying-a-communicator">Destroying a communicator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="communicators.html#error-handling-and-communicator-abort">Error handling and communicator abort</a><ul>
<li class="toctree-l3"><a class="reference internal" href="communicators.html#asynchronous-errors-and-error-handling">Asynchronous errors and error handling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="communicators.html#fault-tolerance">Fault Tolerance</a></li>
<li class="toctree-l2"><a class="reference internal" href="communicators.html#quality-of-service">Quality of Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="collectives.html">Collective Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#allreduce">AllReduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#broadcast">Broadcast</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#reduce">Reduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#allgather">AllGather</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#reducescatter">ReduceScatter</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#alltoall">AlltoAll</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#gather">Gather</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#scatter">Scatter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data.html">Data Pointers</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html">CUDA Stream Semantics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="streams.html#mixing-multiple-streams-within-the-same-ncclgroupstart-end-group">Mixing Multiple Streams within the same ncclGroupStart/End() group</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="groups.html">Group Calls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="groups.html#management-of-multiple-gpus-from-one-thread">Management Of Multiple GPUs From One Thread</a></li>
<li class="toctree-l3"><a class="reference internal" href="groups.html#aggregated-operations-2-2-and-later">Aggregated Operations (2.2 and later)</a></li>
<li class="toctree-l3"><a class="reference internal" href="groups.html#group-operation-ordering-semantics">Group Operation Ordering Semantics</a></li>
<li class="toctree-l3"><a class="reference internal" href="groups.html#nonblocking-group-operation">Nonblocking Group Operation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="p2p.html">Point-to-point communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="p2p.html#two-sided-communication">Two-sided communication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#sendrecv">Sendrecv</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#one-to-all-scatter">One-to-all (scatter)</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#all-to-one-gather">All-to-one (gather)</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#all-to-all">All-to-all</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#neighbor-exchange">Neighbor exchange</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="p2p.html#one-sided-communication">One-sided communication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#putsignal-and-waitsignal">PutSignal and WaitSignal</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#barrier">Barrier</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#id1">All-to-all</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="threadsafety.html">Thread Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="inplace.html">In-place Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="cudagraph.html">Using NCCL with CUDA Graphs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">User Buffer Registration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nvlink-sharp-buffer-registration">NVLink Sharp Buffer Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ib-sharp-buffer-registration">IB Sharp Buffer Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-buffer-registration">General Buffer Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buffer-registration-and-pxn">Buffer Registration and PXN</a></li>
<li class="toctree-l3"><a class="reference internal" href="#memory-allocator">Memory Allocator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#window-registration">Window Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zero-cta-optimization">Zero-CTA Optimization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="deviceapi.html">Device-Initiated Communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#device-api">Device API</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#host-side-setup">Host-Side Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#simple-lsa-kernel">Simple LSA Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#multimem-device-kernel">Multimem Device Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#thread-groups">Thread Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#teams">Teams</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#host-accessible-device-pointer-functions">Host-Accessible Device Pointer Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#gin-device-kernel">GIN Device Kernel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">NCCL API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/comms.html">Communicator Creation and Management Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclgetlasterror">ncclGetLastError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclgeterrorstring">ncclGetErrorString</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclgetversion">ncclGetVersion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclgetuniqueid">ncclGetUniqueId</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcomminitrank">ncclCommInitRank</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcomminitall">ncclCommInitAll</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcomminitrankconfig">ncclCommInitRankConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcomminitrankscalable">ncclCommInitRankScalable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommsplit">ncclCommSplit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommshrink">ncclCommShrink</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommgetuniqueid">ncclCommGetUniqueId</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommgrow">ncclCommGrow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommfinalize">ncclCommFinalize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommrevoke">ncclCommRevoke</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommdestroy">ncclCommDestroy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommabort">ncclCommAbort</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommgetasyncerror">ncclCommGetAsyncError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommcount">ncclCommCount</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommcudevice">ncclCommCuDevice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommuserrank">ncclCommUserRank</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommregister">ncclCommRegister</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommderegister">ncclCommDeregister</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommwindowregister">ncclCommWindowRegister</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommwindowderegister">ncclCommWindowDeregister</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclmemalloc">ncclMemAlloc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclmemfree">ncclMemFree</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/colls.html">Collective Communication Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclallreduce">ncclAllReduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclbroadcast">ncclBroadcast</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclreduce">ncclReduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclallgather">ncclAllGather</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclreducescatter">ncclReduceScatter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclalltoall">ncclAlltoAll</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclgather">ncclGather</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclscatter">ncclScatter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/group.html">Group Calls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/group.html#ncclgroupstart">ncclGroupStart</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/group.html#ncclgroupend">ncclGroupEnd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/group.html#ncclgroupsimulateend">ncclGroupSimulateEnd</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/p2p.html">Point To Point Communication Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/p2p.html#two-sided-point-to-point-operations">Two-Sided Point-to-Point Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/p2p.html#ncclsend">ncclSend</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/p2p.html#ncclrecv">ncclRecv</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/p2p.html#one-sided-point-to-point-operations-rma">One-Sided Point-to-Point Operations (RMA)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/p2p.html#ncclputsignal">ncclPutSignal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/p2p.html#ncclsignal">ncclSignal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/p2p.html#ncclwaitsignal">ncclWaitSignal</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/types.html">Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclcomm-t">ncclComm_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclresult-t">ncclResult_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#nccldatatype-t">ncclDataType_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclredop-t">ncclRedOp_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclscalarresidence-t">ncclScalarResidence_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclconfig-t">ncclConfig_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclsiminfo-t">ncclSimInfo_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclwindow-t">ncclWindow_t</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/ops.html">User Defined Reduction Operators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/ops.html#ncclredopcreatepremulsum">ncclRedOpCreatePreMulSum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/ops.html#ncclredopdestroy">ncclRedOpDestroy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/flags.html">NCCL API Supported Flags</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/flags.html#window-registration-flags">Window Registration Flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/flags.html#nccl-communicator-cta-policy-flags">NCCL Communicator CTA Policy Flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/flags.html#communicator-shrink-flags">Communicator Shrink Flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/device.html">Device API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/device.html#host-side-setup">Host-Side Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#nccldevcomm">ncclDevComm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#nccldevcommcreate">ncclDevCommCreate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#nccldevcommdestroy">ncclDevCommDestroy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#nccldevcommrequirements">ncclDevCommRequirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclcommqueryproperties">ncclCommQueryProperties</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclcommproperties-t">ncclCommProperties_t</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgintype-t">ncclGinType_t</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/device.html#lsa">LSA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#nccllsabarriersession">ncclLsaBarrierSession</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetpeerpointer">ncclGetPeerPointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetlsapointer">ncclGetLsaPointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetlocalpointer">ncclGetLocalPointer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/device.html#multimem">Multimem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetlsamultimempointer">ncclGetLsaMultimemPointer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/device.html#host-accessible-device-pointer-functions">Host-Accessible Device Pointer Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetlsamultimemdevicepointer">ncclGetLsaMultimemDevicePointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetmultimemdevicepointer">ncclGetMultimemDevicePointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetlsadevicepointer">ncclGetLsaDevicePointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetpeerdevicepointer">ncclGetPeerDevicePointer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/device.html#gin">GIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgin">ncclGin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#signals-and-counters">Signals and Counters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclginbarriersession">ncclGinBarrierSession</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../nccl1.html">Migrating from NCCL 1 to NCCL 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#initialization">Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#communication">Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#counts">Counts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#in-place-usage-for-allgather-and-reducescatter">In-place usage for AllGather and ReduceScatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#allgather-arguments-order">AllGather arguments order</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#datatypes">Datatypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#error-codes">Error codes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#communicator-creation-and-destruction-examples">Communicator Creation and Destruction Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-1-single-process-single-thread-multiple-devices">Example 1: Single Process, Single Thread, Multiple Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-2-one-device-per-process-or-thread">Example 2: One Device per Process or Thread</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-3-multiple-devices-per-thread">Example 3: Multiple Devices per Thread</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-4-multiple-communicators-per-device">Example 4: Multiple communicators per device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#communication-examples">Communication Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-1-one-device-per-process-or-thread">Example 1: One Device per Process or Thread</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-2-multiple-devices-per-thread">Example 2: Multiple Devices per Thread</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mpi.html">NCCL and MPI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mpi.html#api">API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#using-multiple-devices-per-process">Using multiple devices per process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#reducescatter-operation">ReduceScatter operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#send-and-receive-counts">Send and Receive counts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#other-collectives-and-point-to-point-operations">Other collectives and point-to-point operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#in-place-operations">In-place operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mpi.html#using-nccl-within-an-mpi-program">Using NCCL within an MPI Program</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#mpi-progress">MPI Progress</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#inter-gpu-communication-with-cuda-aware-mpi">Inter-GPU Communication with CUDA-aware MPI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../env.html">Environment Variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../env.html#system-configuration">System configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-ifname">NCCL_SOCKET_IFNAME</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#values-accepted">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-family">NCCL_SOCKET_FAMILY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id2">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-retry-cnt">NCCL_SOCKET_RETRY_CNT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id3">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-retry-sleep-msec">NCCL_SOCKET_RETRY_SLEEP_MSEC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id4">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-poll-timeout-msec">NCCL_SOCKET_POLL_TIMEOUT_MSEC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id5">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-nthreads">NCCL_SOCKET_NTHREADS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id6">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-nsocks-perthread">NCCL_NSOCKS_PERTHREAD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id7">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-cross-nic">NCCL_CROSS_NIC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id8">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-hca">NCCL_IB_HCA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id9">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-timeout">NCCL_IB_TIMEOUT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id10">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-retry-cnt">NCCL_IB_RETRY_CNT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id11">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-gid-index">NCCL_IB_GID_INDEX</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id12">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-addr-family">NCCL_IB_ADDR_FAMILY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id13">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-addr-range">NCCL_IB_ADDR_RANGE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id14">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-roce-version-num">NCCL_IB_ROCE_VERSION_NUM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id15">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-sl">NCCL_IB_SL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id16">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-tc">NCCL_IB_TC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id17">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-fifo-tc">NCCL_IB_FIFO_TC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id18">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-return-async-events">NCCL_IB_RETURN_ASYNC_EVENTS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id19">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-oob-net-enable">NCCL_OOB_NET_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id20">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-oob-net-ifname">NCCL_OOB_NET_IFNAME</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id21">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-uid-stagger-threshold">NCCL_UID_STAGGER_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id22">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-uid-stagger-rate">NCCL_UID_STAGGER_RATE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id23">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net">NCCL_NET</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id24">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-plugin">NCCL_NET_PLUGIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id25">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-tuner-plugin">NCCL_TUNER_PLUGIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id26">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-profiler-plugin">NCCL_PROFILER_PLUGIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id27">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-env-plugin">NCCL_ENV_PLUGIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id28">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ignore-cpu-affinity">NCCL_IGNORE_CPU_AFFINITY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id29">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-conf-file">NCCL_CONF_FILE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id30">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-debug">NCCL_DEBUG</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id32">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-debug-file">NCCL_DEBUG_FILE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id33">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-debug-subsys">NCCL_DEBUG_SUBSYS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id34">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-debug-timestamp-format">NCCL_DEBUG_TIMESTAMP_FORMAT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#value-accepted">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-debug-timestamp-levels">NCCL_DEBUG_TIMESTAMP_LEVELS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id35">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-collnet-enable">NCCL_COLLNET_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id36">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-collnet-node-threshold">NCCL_COLLNET_NODE_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id37">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-cta-policy">NCCL_CTA_POLICY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id38">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-netdevs-policy">NCCL_NETDEVS_POLICY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id39">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-topo-file">NCCL_TOPO_FILE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id40">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-topo-dump-file">NCCL_TOPO_DUMP_FILE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id41">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-set-thread-name">NCCL_SET_THREAD_NAME</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id42">Value accepted</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../env.html#debugging">Debugging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-disable">NCCL_P2P_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id43">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-level">NCCL_P2P_LEVEL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id44">Values accepted</a></li>
<li class="toctree-l4"><a class="reference internal" href="../env.html#integer-values-legacy">Integer Values (Legacy)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-direct-disable">NCCL_P2P_DIRECT_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id45">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-shm-disable">NCCL_SHM_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id46">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-buffsize">NCCL_BUFFSIZE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id47">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-nthreads">NCCL_NTHREADS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id48">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-max-nchannels">NCCL_MAX_NCHANNELS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id49">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-min-nchannels">NCCL_MIN_NCHANNELS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id50">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-checks-disable">NCCL_CHECKS_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id51">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-check-pointers">NCCL_CHECK_POINTERS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id52">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-launch-mode">NCCL_LAUNCH_MODE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id53">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-disable">NCCL_IB_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id54">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-ar-threshold">NCCL_IB_AR_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id55">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-qps-per-connection">NCCL_IB_QPS_PER_CONNECTION</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id56">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-split-data-on-qps">NCCL_IB_SPLIT_DATA_ON_QPS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id57">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-cuda-support">NCCL_IB_CUDA_SUPPORT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id58">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-pci-relaxed-ordering">NCCL_IB_PCI_RELAXED_ORDERING</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id59">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-adaptive-routing">NCCL_IB_ADAPTIVE_ROUTING</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id60">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-ece-enable">NCCL_IB_ECE_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id61">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-mem-sync-domain">NCCL_MEM_SYNC_DOMAIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id62">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-cumem-enable">NCCL_CUMEM_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id63">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-cumem-host-enable">NCCL_CUMEM_HOST_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id64">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-gdr-level-formerly-nccl-ib-gdr-level">NCCL_NET_GDR_LEVEL (formerly NCCL_IB_GDR_LEVEL)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id65">Values accepted</a></li>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id66">Integer Values (Legacy)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-gdr-c2c">NCCL_NET_GDR_C2C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id67">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-gdr-read">NCCL_NET_GDR_READ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id68">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-shared-buffers">NCCL_NET_SHARED_BUFFERS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id69">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-shared-comms">NCCL_NET_SHARED_COMMS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id70">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-single-ring-threshold">NCCL_SINGLE_RING_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id71">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ll-threshold">NCCL_LL_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id72">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-tree-threshold">NCCL_TREE_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id73">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-algo">NCCL_ALGO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id74">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-proto">NCCL_PROTO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id75">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-nvb-disable">NCCL_NVB_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id76">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-pxn-disable">NCCL_PXN_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id77">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-pxn-level">NCCL_P2P_PXN_LEVEL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id78">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-pxn-c2c">NCCL_PXN_C2C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id79">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-runtime-connect">NCCL_RUNTIME_CONNECT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id80">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-graph-register">NCCL_GRAPH_REGISTER</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id82">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-local-register">NCCL_LOCAL_REGISTER</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id83">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-legacy-cuda-register">NCCL_LEGACY_CUDA_REGISTER</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id84">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-win-enable">NCCL_WIN_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id85">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-set-stack-size">NCCL_SET_STACK_SIZE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id86">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-graph-mixing-support">NCCL_GRAPH_MIXING_SUPPORT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id88">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-dmabuf-enable">NCCL_DMABUF_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id89">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-net-chunksize">NCCL_P2P_NET_CHUNKSIZE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id90">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-ll-threshold">NCCL_P2P_LL_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id91">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-alloc-p2p-net-ll-buffers">NCCL_ALLOC_P2P_NET_LL_BUFFERS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id92">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-comm-blocking">NCCL_COMM_BLOCKING</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id93">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-cga-cluster-size">NCCL_CGA_CLUSTER_SIZE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id94">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-max-ctas">NCCL_MAX_CTAS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id95">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-min-ctas">NCCL_MIN_CTAS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id96">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-nvls-enable">NCCL_NVLS_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id97">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-merge-nics">NCCL_IB_MERGE_NICS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id98">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-mnnvl-enable">NCCL_MNNVL_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id99">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-mnnvl-uuid">NCCL_MNNVL_UUID</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id100">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-mnnvl-clique-id">NCCL_MNNVL_CLIQUE_ID</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id101">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ras-enable">NCCL_RAS_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id102">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ras-addr">NCCL_RAS_ADDR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id103">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ras-timeout-factor">NCCL_RAS_TIMEOUT_FACTOR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id104">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-launch-order-implicit">NCCL_LAUNCH_ORDER_IMPLICIT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id106">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-launch-race-fatal">NCCL_LAUNCH_RACE_FATAL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id107">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ipc-use-abstract-socket">NCCL_IPC_USE_ABSTRACT_SOCKET</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id108">Values accepted</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#errors">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#ras">RAS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting/ras.html">RAS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/ras.html#principle-of-operation">Principle of Operation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/ras.html#ras-queries">RAS Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/ras.html#sample-output">Sample Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/ras.html#json-output">JSON Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/ras.html#monitoring-mode">Monitoring Mode</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#gpu-direct">GPU Direct</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#gpu-to-gpu-communication">GPU-to-GPU communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#gpu-to-nic-communication">GPU-to-NIC communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#pci-access-control-services-acs">PCI Access Control Services (ACS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#topology-detection">Topology detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#memory-issues">Memory issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#shared-memory">Shared memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#stack-size">Stack size</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#unified-memory-uvm">Unified Memory (UVM)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#networking-issues">Networking issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#ip-network-interfaces">IP Network Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#ip-ports">IP Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#infiniband">InfiniBand</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#rdma-over-converged-ethernet-roce">RDMA over Converged Ethernet (RoCE)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NCCL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../usage.html">Using NCCL</a></li>
      <li class="breadcrumb-item active">User Buffer Registration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/usage/bufferreg.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="user-buffer-registration">
<span id="user-buffer-reg"></span><h1>User Buffer Registration<a class="headerlink" href="#user-buffer-registration" title="Permalink to this heading"></a></h1>
<p>User Buffer Registration is a feature that allows NCCL to directly send/receive/operate data through the user buffer without extra internal copy (zero-copy).
It can accelerate collectives and greatly reduce the resource usage (e.g. #channel usage). NCCL provides two ways to register user buffers; one is <em>CUDA Graph</em>
registration, and the other is <em>Local</em> registration. NCCL requires that for all NCCL communication function calls (e.g., allreduce, sendrecv, and so on), if any
rank in a communicator passes registered buffers to a NCCL communication function, all other ranks in the same communicator must pass their registered buffers;
otherwise, mixing registered and non-registered buffers can result in undefined behavior; in addition, source and destination buffers must be registered in order
to enable user buffer registration for NCCL operations.</p>
<section id="nvlink-sharp-buffer-registration">
<h2>NVLink Sharp Buffer Registration<a class="headerlink" href="#nvlink-sharp-buffer-registration" title="Permalink to this heading"></a></h2>
<p>Since 2.19.x, NCCL supports user buffer registration for NVLink Sharp (NVLS); any NCCL collectives (e.g., allreduce) that support NVLS algorithm can utilize this feature.</p>
<p>To enable the <em>CUDA Graph</em> based buffer registration for NVLS, users have to comply with several requirements:</p>
<blockquote>
<div><ul class="simple">
<li><p>The buffer is allocated through <a class="reference internal" href="../api/comms.html#c.ncclMemAlloc" title="ncclMemAlloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclMemAlloc()</span></code></a> or a qualified allocator (see <a class="reference internal" href="#mem-allocator"><span class="std std-ref">Memory Allocator</span></a>).</p></li>
<li><p>The NCCL operation is launched on a stream captured by a CUDA graph for each rank.</p></li>
<li><p>Offset to the head address of the buffer is the same in collectives for each rank.</p></li>
</ul>
</div></blockquote>
<p>Registered buffers will be deregistered when the CUDA graph is destroyed. Here is a CUDA graph based buffer registration example:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">sendbuff</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">recvbuff</span><span class="p">;</span>
<span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemAlloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sendbuff</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemAlloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">recvbuff</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>

<span class="n">cudaGraph_t</span><span class="w"> </span><span class="n">graph</span><span class="p">;</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaStreamBeginCapture</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="n">cudaStreamCaptureModeThreadLocal</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclAllReduce</span><span class="p">(</span><span class="n">sendbuff</span><span class="p">,</span><span class="w"> </span><span class="n">recvbuff</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="n">ncclFloat</span><span class="p">,</span><span class="w"> </span><span class="n">ncclSum</span><span class="p">,</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">));</span>
<span class="c1">// Same offset to the sendbuff and recvbuff head address for each rank</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclAllReduce</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)((</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">sendbuff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1024</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)((</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">recvbuff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2048</span><span class="p">),</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="n">ncclFloat</span><span class="p">,</span><span class="w"> </span><span class="n">ncclSum</span><span class="p">,</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaStreamEndCapture</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">graph</span><span class="p">));</span>

<span class="n">cudaGraphExec_t</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaGraphInstantiate</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">graph</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaGraphLaunch</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaStreamSynchronize</span><span class="p">(</span><span class="n">stream</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaGraphExecDestroy</span><span class="p">(</span><span class="n">instance</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaGraphDestroy</span><span class="p">(</span><span class="n">graph</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemFree</span><span class="p">(</span><span class="n">sendbuff</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemFree</span><span class="p">(</span><span class="n">recvbuff</span><span class="p">));</span>
</pre></div>
</div>
<p>On the other hand, to enable the <em>Local</em> based buffer registration for NVLS, users have to comply with the following requirements:</p>
<blockquote>
<div><ul class="simple">
<li><p>The buffer is allocated through <a class="reference internal" href="../api/comms.html#c.ncclMemAlloc" title="ncclMemAlloc"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclMemAlloc()</span></code></a> or a qualified allocator (see <a class="reference internal" href="#mem-allocator"><span class="std std-ref">Memory Allocator</span></a>).</p></li>
<li><p>Register buffer with <a class="reference internal" href="../api/comms.html#c.ncclCommRegister" title="ncclCommRegister"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommRegister()</span></code></a> before calling collectives for each rank.</p></li>
<li><p>Call NCCL collectives as usual but similarly keep the offset to the head address of the buffer the same for each rank.</p></li>
</ul>
</div></blockquote>
<p>Registered buffers will be deregistered when users explicitly call <a class="reference internal" href="../api/comms.html#c.ncclCommDeregister" title="ncclCommDeregister"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommDeregister()</span></code></a>. Here is a local based buffer registration example:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">sendbuff</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">recvbuff</span><span class="p">;</span>
<span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">sendRegHandle</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">recvRegHandle</span><span class="p">;</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemAlloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sendbuff</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemAlloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">recvbuff</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommRegister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">sendbuff</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sendRegHandle</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommRegister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">recvbuff</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">recvRegHandle</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclAllReduce</span><span class="p">(</span><span class="n">sendbuff</span><span class="p">,</span><span class="w"> </span><span class="n">recvbuff</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="n">ncclFloat</span><span class="p">,</span><span class="w"> </span><span class="n">ncclSum</span><span class="p">,</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclAllReduce</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)((</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">sendbuff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1024</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)((</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span><span class="n">recvbuff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2048</span><span class="p">),</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="n">ncclFloat</span><span class="p">,</span><span class="w"> </span><span class="n">ncclSum</span><span class="p">,</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaStreamSynchronize</span><span class="p">(</span><span class="n">stream</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommDeregister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">sendRegHandle</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommDeregister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">recvRegHandle</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemFree</span><span class="p">(</span><span class="n">sendbuff</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemFree</span><span class="p">(</span><span class="n">recvbuff</span><span class="p">));</span>
</pre></div>
</div>
<p>For local based registration, users can register the buffer once at the beginning of the program and reuse the buffer multiple times to utilize
registration benefits.</p>
<p>To save the memory, it is also valid to allocate a large chunk of buffer and register it once. <cite>sendbuff</cite> and <cite>recvbuff</cite> can be further
allocated through the big chunk for zero-copy NCCL operations as long as <cite>sendbuff</cite> and <cite>recvbuff</cite> satisfy the offset requirements. The following
example shows a use case:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">handle</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">sendbuff</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">recvbuff</span><span class="p">;</span>
<span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">29</span><span class="p">;</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemAlloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommRegister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">handle</span><span class="p">));</span>

<span class="c1">// assign buffer chunk to sendbuff and recvbuff</span>
<span class="n">sendbuff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<span class="n">recvbuff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">20</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclAllReduce</span><span class="p">(</span><span class="n">sendbuff</span><span class="p">,</span><span class="w"> </span><span class="n">recvbuff</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="n">ncclFloat</span><span class="p">,</span><span class="w"> </span><span class="n">ncclSum</span><span class="p">,</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclAllGather</span><span class="p">(</span><span class="n">sendbuff</span><span class="p">,</span><span class="w"> </span><span class="n">recvbuff</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="n">ncclInt8</span><span class="p">,</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaStreamSynchronize</span><span class="p">(</span><span class="n">stream</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommDeregister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">handle</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemFree</span><span class="p">(</span><span class="n">sendbuff</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="ib-sharp-buffer-registration">
<h2>IB Sharp Buffer Registration<a class="headerlink" href="#ib-sharp-buffer-registration" title="Permalink to this heading"></a></h2>
<p>NCCL 2.21.x supports IB Sharp buffer registration, any NCCL collectives that support IB Sharp algorithm can benefit from the feature such as allreduce,
reducescatter, and allgather. Currently, NCCL only supports IB Sharp buffer registration for the communicators which contain 1 rank per node, and the
registration can reduce the number of NCCL SM usage down to 1.</p>
<p>To enable IB Sharp buffer registration by CUDA graph:</p>
<blockquote>
<div><ul class="simple">
<li><p>Allocate send and recv buffer with any CUDA allcator (e.g., cudaMalloc/ncclMemAlloc)</p></li>
<li><p>Launch NCCL collectives with CUDA graph</p></li>
</ul>
</div></blockquote>
<p>To enable IB Sharp buffer registration by local registration:</p>
<blockquote>
<div><ul class="simple">
<li><p>Allocate send and recv buffer with any CUDA allcator (e.g., cudaMalloc/ncclMemAlloc)</p></li>
<li><p>Register send and recv buffer for each rank in the communicator with <cite>ncclCommRegister</cite></p></li>
<li><p>Launch NCCL collectives</p></li>
</ul>
</div></blockquote>
</section>
<section id="general-buffer-registration">
<h2>General Buffer Registration<a class="headerlink" href="#general-buffer-registration" title="Permalink to this heading"></a></h2>
<p>Since 2.23.x, NCCL supports intra-node buffer registration, which targets all peer-to-peer intra-node communications (e.g., Allgather Ring) and brings less memory pressure, better communication and computation overlap performance. Either registering buffers by <cite>ncclCommRegister</cite> in the beginning or applying CUDA graph can enable intra-node buffer registration for NCCL collectives and sendrecv.</p>
<p>The user buffers can be allocated through VMM API (i.e., <cite>cuMem*</cite>), any VMM-based allocators (<a class="reference internal" href="#mem-allocator"><span class="std std-ref">Memory Allocator</span></a>) or <cite>ncclMemAlloc</cite> will work. The buffers allocated through legacy cuda API (e.g., <cite>cudaMalloc</cite>) can also be used for registration. However, it is not safe due to the potential hang during execution and segmentation fault during failure and abort, so using legacy buffers for registration is not recommended; currently, legacy buffer registration is disabled by default, users can set <cite>NCCL_LEGACY_CUDA_REGISTER=1</cite> to enable it.</p>
</section>
<section id="buffer-registration-and-pxn">
<h2>Buffer Registration and PXN<a class="headerlink" href="#buffer-registration-and-pxn" title="Permalink to this heading"></a></h2>
<p>Buffer registration for network communication (e.g., InfiniBand) and PXN are inherently incompatible. PXN is enabled by default in NCCL as long as the platform supports it, and it can be used for sendrecv-based operations and collectives. When PXN is enabled, the network buffer registration will not be enabled even if users have called <cite>ncclCommRegister</cite> to register the buffers. To enable network buffer registration, users can set <cite>NCCL_PXN_DISABLE=1</cite> to disable PXN.</p>
</section>
<section id="memory-allocator">
<span id="mem-allocator"></span><h2>Memory Allocator<a class="headerlink" href="#memory-allocator" title="Permalink to this heading"></a></h2>
<p>For convenience, NCCL provides <cite>ncclMemAlloc</cite> function to help users to allocate buffers through VMM API, which can be used for NCCL registration later. It is only designed for NCCL so that it is not recommended to use <cite>ncclMemAlloc</cite> allocated buffers everywhere in the applications.</p>
<p>For advanced users, if you want to create your own memory allocator for NVLS UB, the allocated buffer of the allocator needs to satisfy the following requirements:</p>
<blockquote>
<div><ul class="simple">
<li><p>Allocate buffer with shared flag <cite>CU_MEM_HANDLE_TYPE_POSIX_FILE_DESCRIPTOR</cite> and also <cite>CU_MEM_HANDLE_TYPE_FABRIC</cite> on GPUs where its supported.</p></li>
<li><p>Buffer physical memory size is multiple of CUMEM recommended granularity (i.e. cuMemGetAllocationGranularity(, <cite>CU_MEM_ALLOC_GRANULARITY_RECOMMENDED`</cite>))</p></li>
<li><p>Buffer virtual head address is at least aligned to CUMEM recommended granularity and size is multiple of CUMEM recommended granularity.</p></li>
</ul>
</div></blockquote>
<p>For general buffer registration with VMM API, the allocator needs to satisfy the same requirements as NVLS UB allocators.</p>
</section>
<section id="window-registration">
<span id="window-reg"></span><h2>Window Registration<a class="headerlink" href="#window-registration" title="Permalink to this heading"></a></h2>
<p>Since 2.27, NCCL supports window registration, which allows users to register local buffers into NCCL window and enables extremely low latency and high bandwith communication in NCCL. Currently, window registration supports input buffers only from VMM-based allocators (<a class="reference internal" href="#mem-allocator"><span class="std std-ref">Memory Allocator</span></a>) and <cite>ncclMemAlloc</cite>; any other type of cuda buffers will fail to be registered.</p>
<p>NCCL window registration is enabled by default. However, if users do not use window registration and need to turn it off, set <cite>NCCL_WIN_ENABLE=0</cite> to disable it. In addition, users can also control the behavior of window registration through flags in <a class="reference internal" href="../api/flags.html#win-flags"><span class="std std-ref">Window Registration Flags</span></a>.</p>
<p>The following example shows how to register buffers into NCCL window and use it for communication:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">src</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">dst</span><span class="p">;</span>
<span class="n">ncclWindow_t</span><span class="w"> </span><span class="n">src_win</span><span class="p">;</span>
<span class="n">ncclWindow_t</span><span class="w"> </span><span class="n">dst_win</span><span class="p">;</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemAlloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">src_size</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemAlloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dst</span><span class="p">,</span><span class="w"> </span><span class="n">dst_size</span><span class="p">));</span>
<span class="c1">// Passing NCCL_WIN_COLL_SYMMETRIC requires users to provide the symmetric buffers among all ranks in collectives.</span>
<span class="c1">// Every rank needs to call ncclCommWindowRegister to register its buffers.</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommWindowRegister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">src_size</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">src_win</span><span class="p">,</span><span class="w"> </span><span class="n">NCCL_WIN_COLL_SYMMETRIC</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommWindowRegister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">dst</span><span class="p">,</span><span class="w"> </span><span class="n">dst_size</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dst_win</span><span class="p">,</span><span class="w"> </span><span class="n">NCCL_WIN_COLL_SYMMETRIC</span><span class="p">));</span>
<span class="c1">// Use the registered buffers for communication to enable symmetric communication benefits.</span>
<span class="c1">// In this example, every rank has 0x1000 offset and 0x2000 offset from the head address of</span>
<span class="c1">// src and dst respectively, which satisfies the symmetric buffer requirement.</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclAllGather</span><span class="p">((</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">src</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">0x1000</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">dst</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">0x2000</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ncclInt8</span><span class="p">,</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaStreamSynchronize</span><span class="p">(</span><span class="n">stream</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommWindowDeregister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">src_win</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommWindowDeregister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">dst_win</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemFree</span><span class="p">(</span><span class="n">src</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemFree</span><span class="p">(</span><span class="n">dst</span><span class="p">));</span>
</pre></div>
</div>
<p>See the description of <a class="reference internal" href="../api/comms.html#c.ncclCommWindowRegister" title="ncclCommWindowRegister"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommWindowRegister()</span></code></a> and <a class="reference internal" href="../api/comms.html#c.ncclCommWindowDeregister" title="ncclCommWindowDeregister"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommWindowDeregister()</span></code></a> for additional details.</p>
</section>
<section id="zero-cta-optimization">
<h2>Zero-CTA Optimization<a class="headerlink" href="#zero-cta-optimization" title="Permalink to this heading"></a></h2>
<p>Since NCCL version 2.28, NCCL supports zero-CTA optimization. Zero-CTA optimization aims to avoid the use of CTA for communication and to overlap communication and computation.</p>
<p>Current zero-CTA optimization supports using the Copy Engine (CE) to perform the communication. The following are the requirements to enable zero-CTA optimization with CE:</p>
<blockquote>
<div><ul class="simple">
<li><p>CUDA driver version &gt;= 12.5</p></li>
<li><p>Collectives run within a single NVL or MNNVL domain (does not support network, e.g., IB/ROCE)</p></li>
<li><p>The buffer is symmetrically registered with the NCCL window</p></li>
<li><p>The communicator is configured with the <code class="docutils literal notranslate"><span class="pre">NCCL_CTA_POLICY_ZERO</span></code> flag (please see <a class="reference internal" href="../api/flags.html#cta-policy-flags"><span class="std std-ref">NCCL Communicator CTA Policy Flags</span></a>)</p></li>
<li><p>Supported collectives are AlltoAll, AllGather, Scatter, and Gather</p></li>
</ul>
</div></blockquote>
<p>The following example shows how to enable zero-CTA optimization:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ncclConfig_t</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NCCL_CONFIG_INITIALIZER</span><span class="p">;</span>
<span class="c1">// NCCL_CTA_POLICY_ZERO to enable zero-CTA optimization whenever possible</span>
<span class="n">config</span><span class="p">.</span><span class="n">CTAPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NCCL_CTA_POLICY_ZERO</span><span class="p">;</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommInitRankConfig</span><span class="p">(</span><span class="o">&amp;</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">nranks</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">));</span>

<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">src</span><span class="p">;</span>
<span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">dst</span><span class="p">;</span>
<span class="n">ncclWindow_t</span><span class="w"> </span><span class="n">src_win</span><span class="p">;</span>
<span class="n">ncclWindow_t</span><span class="w"> </span><span class="n">dst_win</span><span class="p">;</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemAlloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">src_size</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemAlloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dst</span><span class="p">,</span><span class="w"> </span><span class="n">dst_size</span><span class="p">));</span>

<span class="c1">// Register the buffers into NCCL symmetric window</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommWindowRegister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">src_size</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">src_win</span><span class="p">,</span><span class="w"> </span><span class="n">NCCL_WIN_COLL_SYMMETRIC</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommWindowRegister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">dst</span><span class="p">,</span><span class="w"> </span><span class="n">dst_size</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dst_win</span><span class="p">,</span><span class="w"> </span><span class="n">NCCL_WIN_COLL_SYMMETRIC</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclAllGather</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">dst</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ncclInt8</span><span class="p">,</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">cudaStreamSynchronize</span><span class="p">(</span><span class="n">stream</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommWindowDeregister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">src_win</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommWindowDeregister</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">dst_win</span><span class="p">));</span>

<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemFree</span><span class="p">(</span><span class="n">src</span><span class="p">));</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclMemFree</span><span class="p">(</span><span class="n">dst</span><span class="p">));</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cudagraph.html" class="btn btn-neutral float-left" title="Using NCCL with CUDA Graphs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="deviceapi.html" class="btn btn-neutral float-right" title="Device-Initiated Communication" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2025, NVIDIA Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  
  <style>
  a:link, a:visited {
    color: #76b900;
  }
  a:hover {
    color: #8c0;
  }
  .rst-content dl:not(.docutils) dt {
    background: rgba(118, 185, 0, 0.1) !important;
    color: rgba(59,93,0,1) !important;
    border-top: solid 3px rgba(59,93,0,1) !important;
  }
  </style>
  <script type="text/javascript">_satellite.pageBottom();</script>


</body>
</html>