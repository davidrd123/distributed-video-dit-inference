<!DOCTYPE html>
<html class="writer-html5" lang="en-US">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating a Communicator &mdash; NCCL 2.29.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=8eabb79f" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=324d1df1"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Collective Operations" href="collectives.html" />
    <link rel="prev" title="Using NCCL" href="../usage.html" />
  <script src="https://assets.adobedtm.com/5d4962a43b79/c1061d2c5e7b/launch-191c2462b890.min.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" > 

          
          
          <a href="../index.html" class="icon icon-home">
            NCCL
          </a>
              <div class="version">
                <a href="https://docs.nvidia.com/deeplearning/sdk/nccl-archived/index.html">2.29</a>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #76b900;
    }
    .wy-side-nav-search a:link, .wy-nav-top a:link {
      color: #fff;
    }
    .wy-side-nav-search a:visited, .wy-nav-top a:visited {
      color: #fff;
    }
    .wy-side-nav-search a:hover, .wy-nav-top a:hover {
      color: #fff;
    }
    .wy-menu-vertical a:link, .wy-menu-vertical a:visited {
      color: #d9d9d9
    }
    .wy-menu-vertical a:active {
      background-color: #76b900
    }
    .wy-side-nav-search>div.version {
      color: rgba(0, 0, 0, 0.3)
    }
  </style>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview of NCCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../usage.html">Using NCCL</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Creating a Communicator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-communicator-with-options">Creating a communicator with options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-communicator-using-multiple-nccluniqueids">Creating a communicator using multiple ncclUniqueIds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shrinking-a-communicator">Shrinking a communicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#growing-a-communicator">Growing a communicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-more-communicators">Creating more communicators</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-multiple-nccl-communicators-concurrently">Using multiple NCCL communicators concurrently</a></li>
<li class="toctree-l3"><a class="reference internal" href="#finalizing-a-communicator">Finalizing a communicator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#destroying-a-communicator">Destroying a communicator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#error-handling-and-communicator-abort">Error handling and communicator abort</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#asynchronous-errors-and-error-handling">Asynchronous errors and error handling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fault-tolerance">Fault Tolerance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quality-of-service">Quality of Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="collectives.html">Collective Operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#allreduce">AllReduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#broadcast">Broadcast</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#reduce">Reduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#allgather">AllGather</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#reducescatter">ReduceScatter</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#alltoall">AlltoAll</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#gather">Gather</a></li>
<li class="toctree-l3"><a class="reference internal" href="collectives.html#scatter">Scatter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data.html">Data Pointers</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html">CUDA Stream Semantics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="streams.html#mixing-multiple-streams-within-the-same-ncclgroupstart-end-group">Mixing Multiple Streams within the same ncclGroupStart/End() group</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="groups.html">Group Calls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="groups.html#management-of-multiple-gpus-from-one-thread">Management Of Multiple GPUs From One Thread</a></li>
<li class="toctree-l3"><a class="reference internal" href="groups.html#aggregated-operations-2-2-and-later">Aggregated Operations (2.2 and later)</a></li>
<li class="toctree-l3"><a class="reference internal" href="groups.html#group-operation-ordering-semantics">Group Operation Ordering Semantics</a></li>
<li class="toctree-l3"><a class="reference internal" href="groups.html#nonblocking-group-operation">Nonblocking Group Operation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="p2p.html">Point-to-point communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="p2p.html#two-sided-communication">Two-sided communication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#sendrecv">Sendrecv</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#one-to-all-scatter">One-to-all (scatter)</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#all-to-one-gather">All-to-one (gather)</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#all-to-all">All-to-all</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#neighbor-exchange">Neighbor exchange</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="p2p.html#one-sided-communication">One-sided communication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#putsignal-and-waitsignal">PutSignal and WaitSignal</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#barrier">Barrier</a></li>
<li class="toctree-l4"><a class="reference internal" href="p2p.html#id1">All-to-all</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="threadsafety.html">Thread Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="inplace.html">In-place Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="cudagraph.html">Using NCCL with CUDA Graphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="bufferreg.html">User Buffer Registration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="bufferreg.html#nvlink-sharp-buffer-registration">NVLink Sharp Buffer Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="bufferreg.html#ib-sharp-buffer-registration">IB Sharp Buffer Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="bufferreg.html#general-buffer-registration">General Buffer Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="bufferreg.html#buffer-registration-and-pxn">Buffer Registration and PXN</a></li>
<li class="toctree-l3"><a class="reference internal" href="bufferreg.html#memory-allocator">Memory Allocator</a></li>
<li class="toctree-l3"><a class="reference internal" href="bufferreg.html#window-registration">Window Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="bufferreg.html#zero-cta-optimization">Zero-CTA Optimization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="deviceapi.html">Device-Initiated Communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#device-api">Device API</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#host-side-setup">Host-Side Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#simple-lsa-kernel">Simple LSA Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#multimem-device-kernel">Multimem Device Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#thread-groups">Thread Groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#teams">Teams</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#host-accessible-device-pointer-functions">Host-Accessible Device Pointer Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="deviceapi.html#gin-device-kernel">GIN Device Kernel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">NCCL API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/comms.html">Communicator Creation and Management Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclgetlasterror">ncclGetLastError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclgeterrorstring">ncclGetErrorString</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclgetversion">ncclGetVersion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclgetuniqueid">ncclGetUniqueId</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcomminitrank">ncclCommInitRank</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcomminitall">ncclCommInitAll</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcomminitrankconfig">ncclCommInitRankConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcomminitrankscalable">ncclCommInitRankScalable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommsplit">ncclCommSplit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommshrink">ncclCommShrink</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommgetuniqueid">ncclCommGetUniqueId</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommgrow">ncclCommGrow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommfinalize">ncclCommFinalize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommrevoke">ncclCommRevoke</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommdestroy">ncclCommDestroy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommabort">ncclCommAbort</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommgetasyncerror">ncclCommGetAsyncError</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommcount">ncclCommCount</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommcudevice">ncclCommCuDevice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommuserrank">ncclCommUserRank</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommregister">ncclCommRegister</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommderegister">ncclCommDeregister</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommwindowregister">ncclCommWindowRegister</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclcommwindowderegister">ncclCommWindowDeregister</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclmemalloc">ncclMemAlloc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/comms.html#ncclmemfree">ncclMemFree</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/colls.html">Collective Communication Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclallreduce">ncclAllReduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclbroadcast">ncclBroadcast</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclreduce">ncclReduce</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclallgather">ncclAllGather</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclreducescatter">ncclReduceScatter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclalltoall">ncclAlltoAll</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclgather">ncclGather</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/colls.html#ncclscatter">ncclScatter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/group.html">Group Calls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/group.html#ncclgroupstart">ncclGroupStart</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/group.html#ncclgroupend">ncclGroupEnd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/group.html#ncclgroupsimulateend">ncclGroupSimulateEnd</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/p2p.html">Point To Point Communication Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/p2p.html#two-sided-point-to-point-operations">Two-Sided Point-to-Point Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/p2p.html#ncclsend">ncclSend</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/p2p.html#ncclrecv">ncclRecv</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/p2p.html#one-sided-point-to-point-operations-rma">One-Sided Point-to-Point Operations (RMA)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/p2p.html#ncclputsignal">ncclPutSignal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/p2p.html#ncclsignal">ncclSignal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/p2p.html#ncclwaitsignal">ncclWaitSignal</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/types.html">Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclcomm-t">ncclComm_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclresult-t">ncclResult_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#nccldatatype-t">ncclDataType_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclredop-t">ncclRedOp_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclscalarresidence-t">ncclScalarResidence_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclconfig-t">ncclConfig_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclsiminfo-t">ncclSimInfo_t</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/types.html#ncclwindow-t">ncclWindow_t</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/ops.html">User Defined Reduction Operators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/ops.html#ncclredopcreatepremulsum">ncclRedOpCreatePreMulSum</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/ops.html#ncclredopdestroy">ncclRedOpDestroy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/flags.html">NCCL API Supported Flags</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/flags.html#window-registration-flags">Window Registration Flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/flags.html#nccl-communicator-cta-policy-flags">NCCL Communicator CTA Policy Flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/flags.html#communicator-shrink-flags">Communicator Shrink Flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/device.html">Device API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/device.html#host-side-setup">Host-Side Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#nccldevcomm">ncclDevComm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#nccldevcommcreate">ncclDevCommCreate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#nccldevcommdestroy">ncclDevCommDestroy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#nccldevcommrequirements">ncclDevCommRequirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclcommqueryproperties">ncclCommQueryProperties</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclcommproperties-t">ncclCommProperties_t</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgintype-t">ncclGinType_t</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/device.html#lsa">LSA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#nccllsabarriersession">ncclLsaBarrierSession</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetpeerpointer">ncclGetPeerPointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetlsapointer">ncclGetLsaPointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetlocalpointer">ncclGetLocalPointer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/device.html#multimem">Multimem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetlsamultimempointer">ncclGetLsaMultimemPointer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/device.html#host-accessible-device-pointer-functions">Host-Accessible Device Pointer Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetlsamultimemdevicepointer">ncclGetLsaMultimemDevicePointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetmultimemdevicepointer">ncclGetMultimemDevicePointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetlsadevicepointer">ncclGetLsaDevicePointer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgetpeerdevicepointer">ncclGetPeerDevicePointer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/device.html#gin">GIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclgin">ncclGin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#signals-and-counters">Signals and Counters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/device.html#ncclginbarriersession">ncclGinBarrierSession</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../nccl1.html">Migrating from NCCL 1 to NCCL 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#initialization">Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#communication">Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#counts">Counts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#in-place-usage-for-allgather-and-reducescatter">In-place usage for AllGather and ReduceScatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#allgather-arguments-order">AllGather arguments order</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#datatypes">Datatypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nccl1.html#error-codes">Error codes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#communicator-creation-and-destruction-examples">Communicator Creation and Destruction Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-1-single-process-single-thread-multiple-devices">Example 1: Single Process, Single Thread, Multiple Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-2-one-device-per-process-or-thread">Example 2: One Device per Process or Thread</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-3-multiple-devices-per-thread">Example 3: Multiple Devices per Thread</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-4-multiple-communicators-per-device">Example 4: Multiple communicators per device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#communication-examples">Communication Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-1-one-device-per-process-or-thread">Example 1: One Device per Process or Thread</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples.html#example-2-multiple-devices-per-thread">Example 2: Multiple Devices per Thread</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mpi.html">NCCL and MPI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../mpi.html#api">API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#using-multiple-devices-per-process">Using multiple devices per process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#reducescatter-operation">ReduceScatter operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#send-and-receive-counts">Send and Receive counts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#other-collectives-and-point-to-point-operations">Other collectives and point-to-point operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#in-place-operations">In-place operations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mpi.html#using-nccl-within-an-mpi-program">Using NCCL within an MPI Program</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#mpi-progress">MPI Progress</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mpi.html#inter-gpu-communication-with-cuda-aware-mpi">Inter-GPU Communication with CUDA-aware MPI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../env.html">Environment Variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../env.html#system-configuration">System configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-ifname">NCCL_SOCKET_IFNAME</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#values-accepted">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-family">NCCL_SOCKET_FAMILY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id2">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-retry-cnt">NCCL_SOCKET_RETRY_CNT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id3">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-retry-sleep-msec">NCCL_SOCKET_RETRY_SLEEP_MSEC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id4">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-poll-timeout-msec">NCCL_SOCKET_POLL_TIMEOUT_MSEC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id5">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-socket-nthreads">NCCL_SOCKET_NTHREADS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id6">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-nsocks-perthread">NCCL_NSOCKS_PERTHREAD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id7">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-cross-nic">NCCL_CROSS_NIC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id8">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-hca">NCCL_IB_HCA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id9">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-timeout">NCCL_IB_TIMEOUT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id10">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-retry-cnt">NCCL_IB_RETRY_CNT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id11">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-gid-index">NCCL_IB_GID_INDEX</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id12">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-addr-family">NCCL_IB_ADDR_FAMILY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id13">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-addr-range">NCCL_IB_ADDR_RANGE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id14">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-roce-version-num">NCCL_IB_ROCE_VERSION_NUM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id15">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-sl">NCCL_IB_SL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id16">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-tc">NCCL_IB_TC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id17">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-fifo-tc">NCCL_IB_FIFO_TC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id18">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-return-async-events">NCCL_IB_RETURN_ASYNC_EVENTS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id19">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-oob-net-enable">NCCL_OOB_NET_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id20">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-oob-net-ifname">NCCL_OOB_NET_IFNAME</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id21">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-uid-stagger-threshold">NCCL_UID_STAGGER_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id22">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-uid-stagger-rate">NCCL_UID_STAGGER_RATE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id23">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net">NCCL_NET</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id24">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-plugin">NCCL_NET_PLUGIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id25">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-tuner-plugin">NCCL_TUNER_PLUGIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id26">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-profiler-plugin">NCCL_PROFILER_PLUGIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id27">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-env-plugin">NCCL_ENV_PLUGIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id28">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ignore-cpu-affinity">NCCL_IGNORE_CPU_AFFINITY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id29">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-conf-file">NCCL_CONF_FILE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id30">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-debug">NCCL_DEBUG</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id32">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-debug-file">NCCL_DEBUG_FILE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id33">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-debug-subsys">NCCL_DEBUG_SUBSYS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id34">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-debug-timestamp-format">NCCL_DEBUG_TIMESTAMP_FORMAT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#value-accepted">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-debug-timestamp-levels">NCCL_DEBUG_TIMESTAMP_LEVELS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id35">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-collnet-enable">NCCL_COLLNET_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id36">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-collnet-node-threshold">NCCL_COLLNET_NODE_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id37">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-cta-policy">NCCL_CTA_POLICY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id38">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-netdevs-policy">NCCL_NETDEVS_POLICY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id39">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-topo-file">NCCL_TOPO_FILE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id40">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-topo-dump-file">NCCL_TOPO_DUMP_FILE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id41">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-set-thread-name">NCCL_SET_THREAD_NAME</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id42">Value accepted</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../env.html#debugging">Debugging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-disable">NCCL_P2P_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id43">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-level">NCCL_P2P_LEVEL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id44">Values accepted</a></li>
<li class="toctree-l4"><a class="reference internal" href="../env.html#integer-values-legacy">Integer Values (Legacy)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-direct-disable">NCCL_P2P_DIRECT_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id45">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-shm-disable">NCCL_SHM_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id46">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-buffsize">NCCL_BUFFSIZE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id47">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-nthreads">NCCL_NTHREADS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id48">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-max-nchannels">NCCL_MAX_NCHANNELS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id49">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-min-nchannels">NCCL_MIN_NCHANNELS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id50">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-checks-disable">NCCL_CHECKS_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id51">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-check-pointers">NCCL_CHECK_POINTERS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id52">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-launch-mode">NCCL_LAUNCH_MODE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id53">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-disable">NCCL_IB_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id54">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-ar-threshold">NCCL_IB_AR_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id55">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-qps-per-connection">NCCL_IB_QPS_PER_CONNECTION</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id56">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-split-data-on-qps">NCCL_IB_SPLIT_DATA_ON_QPS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id57">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-cuda-support">NCCL_IB_CUDA_SUPPORT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id58">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-pci-relaxed-ordering">NCCL_IB_PCI_RELAXED_ORDERING</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id59">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-adaptive-routing">NCCL_IB_ADAPTIVE_ROUTING</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id60">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-ece-enable">NCCL_IB_ECE_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id61">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-mem-sync-domain">NCCL_MEM_SYNC_DOMAIN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id62">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-cumem-enable">NCCL_CUMEM_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id63">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-cumem-host-enable">NCCL_CUMEM_HOST_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id64">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-gdr-level-formerly-nccl-ib-gdr-level">NCCL_NET_GDR_LEVEL (formerly NCCL_IB_GDR_LEVEL)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id65">Values accepted</a></li>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id66">Integer Values (Legacy)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-gdr-c2c">NCCL_NET_GDR_C2C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id67">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-gdr-read">NCCL_NET_GDR_READ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id68">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-shared-buffers">NCCL_NET_SHARED_BUFFERS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id69">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-net-shared-comms">NCCL_NET_SHARED_COMMS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id70">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-single-ring-threshold">NCCL_SINGLE_RING_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id71">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ll-threshold">NCCL_LL_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id72">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-tree-threshold">NCCL_TREE_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id73">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-algo">NCCL_ALGO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id74">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-proto">NCCL_PROTO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id75">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-nvb-disable">NCCL_NVB_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id76">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-pxn-disable">NCCL_PXN_DISABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id77">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-pxn-level">NCCL_P2P_PXN_LEVEL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id78">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-pxn-c2c">NCCL_PXN_C2C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id79">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-runtime-connect">NCCL_RUNTIME_CONNECT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id80">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-graph-register">NCCL_GRAPH_REGISTER</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id82">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-local-register">NCCL_LOCAL_REGISTER</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id83">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-legacy-cuda-register">NCCL_LEGACY_CUDA_REGISTER</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id84">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-win-enable">NCCL_WIN_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id85">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-set-stack-size">NCCL_SET_STACK_SIZE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id86">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-graph-mixing-support">NCCL_GRAPH_MIXING_SUPPORT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id88">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-dmabuf-enable">NCCL_DMABUF_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id89">Value accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-net-chunksize">NCCL_P2P_NET_CHUNKSIZE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id90">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-p2p-ll-threshold">NCCL_P2P_LL_THRESHOLD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id91">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-alloc-p2p-net-ll-buffers">NCCL_ALLOC_P2P_NET_LL_BUFFERS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id92">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-comm-blocking">NCCL_COMM_BLOCKING</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id93">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-cga-cluster-size">NCCL_CGA_CLUSTER_SIZE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id94">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-max-ctas">NCCL_MAX_CTAS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id95">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-min-ctas">NCCL_MIN_CTAS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id96">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-nvls-enable">NCCL_NVLS_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id97">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ib-merge-nics">NCCL_IB_MERGE_NICS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id98">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-mnnvl-enable">NCCL_MNNVL_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id99">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-mnnvl-uuid">NCCL_MNNVL_UUID</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id100">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-mnnvl-clique-id">NCCL_MNNVL_CLIQUE_ID</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id101">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ras-enable">NCCL_RAS_ENABLE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id102">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ras-addr">NCCL_RAS_ADDR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id103">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ras-timeout-factor">NCCL_RAS_TIMEOUT_FACTOR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id104">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-launch-order-implicit">NCCL_LAUNCH_ORDER_IMPLICIT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id106">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-launch-race-fatal">NCCL_LAUNCH_RACE_FATAL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id107">Values accepted</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../env.html#nccl-ipc-use-abstract-socket">NCCL_IPC_USE_ABSTRACT_SOCKET</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../env.html#id108">Values accepted</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#errors">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#ras">RAS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting/ras.html">RAS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/ras.html#principle-of-operation">Principle of Operation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/ras.html#ras-queries">RAS Queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/ras.html#sample-output">Sample Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/ras.html#json-output">JSON Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/ras.html#monitoring-mode">Monitoring Mode</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#gpu-direct">GPU Direct</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#gpu-to-gpu-communication">GPU-to-GPU communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#gpu-to-nic-communication">GPU-to-NIC communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#pci-access-control-services-acs">PCI Access Control Services (ACS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#topology-detection">Topology detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#memory-issues">Memory issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#shared-memory">Shared memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#stack-size">Stack size</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#unified-memory-uvm">Unified Memory (UVM)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#networking-issues">Networking issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#ip-network-interfaces">IP Network Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#ip-ports">IP Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#infiniband">InfiniBand</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#rdma-over-converged-ethernet-roce">RDMA over Converged Ethernet (RoCE)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NCCL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../usage.html">Using NCCL</a></li>
      <li class="breadcrumb-item active">Creating a Communicator</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/usage/communicators.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-a-communicator">
<span id="communicator-label"></span><h1>Creating a Communicator<a class="headerlink" href="#creating-a-communicator" title="Permalink to this heading"></a></h1>
<p>When creating a communicator, a unique rank between 0 and n-1 has to be assigned to each of the n CUDA devices which
are part of the communicator. Using the same CUDA device multiple times as different ranks of the same NCCL
communicator is not supported and may lead to hangs.</p>
<p>Given a static mapping of ranks to CUDA devices, the <a class="reference internal" href="../api/comms.html#c.ncclCommInitRank" title="ncclCommInitRank"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommInitRank()</span></code></a>, <a class="reference internal" href="../api/comms.html#c.ncclCommInitRankConfig" title="ncclCommInitRankConfig"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommInitRankConfig()</span></code></a> and
<a class="reference internal" href="../api/comms.html#c.ncclCommInitAll" title="ncclCommInitAll"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommInitAll()</span></code></a> functions will create communicator objects, each communicator object being associated to a
fixed rank and CUDA device. Those objects will then be used to launch communication operations.</p>
<p>Before calling <a class="reference internal" href="../api/comms.html#c.ncclCommInitRank" title="ncclCommInitRank"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommInitRank()</span></code></a>, you need to first create a unique object which will be used by all processes
and threads to synchronize and understand they are part of the same communicator. This is done by calling the
<a class="reference internal" href="../api/comms.html#c.ncclGetUniqueId" title="ncclGetUniqueId"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclGetUniqueId()</span></code></a> function.</p>
<p>The <a class="reference internal" href="../api/comms.html#c.ncclGetUniqueId" title="ncclGetUniqueId"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclGetUniqueId()</span></code></a> function returns an ID which has to be broadcast to all participating threads and
processes using any CPU communication system, for example, passing the ID pointer to multiple threads, or broadcasting
it to other processes using MPI or another parallel environment using, for example, sockets.</p>
<p>You can also call the ncclCommInitAll operation to create n communicator objects at once within a single process. As it
is limited to a single process, this function does not permit inter-node communication. ncclCommInitAll is equivalent
to calling a combination of ncclGetUniqueId and ncclCommInitRank.</p>
<p>The following sample code is a simplified implementation of ncclCommInitAll.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ncclResult_t</span><span class="w"> </span><span class="nf">ncclCommInitAll</span><span class="p">(</span><span class="n">ncclComm_t</span><span class="o">*</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ndev</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">devlist</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">ncclUniqueId</span><span class="w"> </span><span class="n">Id</span><span class="p">;</span>
<span class="w">  </span><span class="n">ncclGetUniqueId</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Id</span><span class="p">);</span>
<span class="w">  </span><span class="n">ncclGroupStart</span><span class="p">();</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">ndev</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cudaSetDevice</span><span class="p">(</span><span class="n">devlist</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">ncclCommInitRank</span><span class="p">(</span><span class="n">comm</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ndev</span><span class="p">,</span><span class="w"> </span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">ncclGroupEnd</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Related links:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../api/comms.html#c.ncclCommInitAll" title="ncclCommInitAll"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommInitAll()</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/comms.html#c.ncclGetUniqueId" title="ncclGetUniqueId"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclGetUniqueId()</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/comms.html#c.ncclCommInitRank" title="ncclCommInitRank"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommInitRank()</span></code></a></p></li>
</ul>
</div></blockquote>
<section id="creating-a-communicator-with-options">
<span id="init-rank-config"></span><h2>Creating a communicator with options<a class="headerlink" href="#creating-a-communicator-with-options" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="../api/comms.html#c.ncclCommInitRankConfig" title="ncclCommInitRankConfig"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommInitRankConfig()</span></code></a> function allows to create a NCCL communicator with specific options.</p>
<p>The config parameters NCCL supports are listed here <a class="reference internal" href="../api/types.html#ncclconfig"><span class="std std-ref">ncclConfig_t</span></a>.</p>
<p>For example, blocking can be set to 0 to ask NCCL to never block in any NCCL call, and at the same time
other config parameters can be set as well to more precisely define communicator behavior. A simple example
code is shown below:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ncclConfig_t</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NCCL_CONFIG_INITIALIZER</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">blocking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">minCTAs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">maxCTAs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">cgaClusterSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">netName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Socket&quot;</span><span class="p">;</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommInitRankConfig</span><span class="p">(</span><span class="o">&amp;</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">nranks</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">));</span>
<span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommGetAsyncError</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state</span><span class="p">));</span>
<span class="w">  </span><span class="c1">// Handle outside events, timeouts, progress, ...</span>
<span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ncclInProgress</span><span class="p">);</span>
</pre></div>
</div>
<p>Related link: <a class="reference internal" href="../api/comms.html#c.ncclCommGetAsyncError" title="ncclCommGetAsyncError"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommGetAsyncError()</span></code></a></p>
</section>
<section id="creating-a-communicator-using-multiple-nccluniqueids">
<h2>Creating a communicator using multiple ncclUniqueIds<a class="headerlink" href="#creating-a-communicator-using-multiple-nccluniqueids" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="../api/comms.html#c.ncclCommInitRankScalable" title="ncclCommInitRankScalable"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommInitRankScalable()</span></code></a> function enables the creation of a NCCL communicator using many ncclUniqueIds.
All NCCL ranks have to provide the same array of ncclUniqueIds (same ncclUniqueIds, and in with the same order).
For the best performance, we recommend distributing the ncclUniqueIds as evenly as possible amongst the NCCL ranks.</p>
<p>Internally, NCCL ranks will mostly communicate with a single ncclUniqueId.
Therefore, to obtain the best results, we recommend to evenly distribute ncclUniqueIds accross the ranks.</p>
<p>The following function can be used to decide if a NCCL rank should create a ncclUniqueIds:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">rankHasRoot</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nRanks</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rmr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nRanks</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">nIds</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rpr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nRanks</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">nIds</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rmr</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">rpr</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rank</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">rlim</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">rank</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">rpr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="p">((</span><span class="n">rank</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rlim</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">rpr</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example, if 3 ncclUniqueIds are to be distributed accross 7 NCCL ranks, the first ncclUniqueId will be associated to
ranks 0-2, while the others will be associated to ranks 3-4, and 5-6.
This function will therefore return true on rank 0, 3, and 5, and false otherwise.</p>
<p>Note: only the first ncclUniqueId will be used to create the communicator hash id, which is used to identify the
communicator in the log file and in the replay tool.</p>
</section>
<section id="shrinking-a-communicator">
<h2>Shrinking a communicator<a class="headerlink" href="#shrinking-a-communicator" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="../api/comms.html#c.ncclCommShrink" title="ncclCommShrink"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommShrink()</span></code></a> function allows you to create a new communicator by removing specific ranks from an existing one.
This is useful when you need to exclude certain GPUs or nodes from a collective operation, for example in fault tolerance scenarios or when dynamically adjusting resource utilization.</p>
<p>The following example demonstrates how to create a new communicator by excluding rank 1:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">excludeRanks</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">};</span><span class="w">  </span><span class="c1">// Rank to exclude</span>
<span class="kt">int</span><span class="w"> </span><span class="n">excludeCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">      </span><span class="c1">// Number of ranks to exclude</span>
<span class="n">ncclComm_t</span><span class="w"> </span><span class="n">newcomm</span><span class="p">;</span>

<span class="c1">// Only ranks that will be in the new communicator should call ncclCommShrink</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">myRank</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">ncclResult_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncclCommShrink</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">excludeRanks</span><span class="p">,</span><span class="w"> </span><span class="n">excludeCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">newcomm</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">NCCL_SHRINK_DEFAULT</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ncclSuccess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Handle error</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Use the new communicator for collective operations</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="w">  </span><span class="c1">// When done, destroy the new communicator</span>
<span class="w">  </span><span class="n">ncclCommDestroy</span><span class="p">(</span><span class="n">newcomm</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When recovering from communication errors, you may want to use the error mode:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">myRank</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// When shrinking after an error, use NCCL_SHRINK_ABORT to abort operations on the parent communicator</span>
<span class="w">  </span><span class="c1">// This mode is also useful when there might be ongoing operations on the parent communicator</span>
<span class="w">  </span><span class="n">ncclResult_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncclCommShrink</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">excludeRanks</span><span class="p">,</span><span class="w"> </span><span class="n">excludeCount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">newcomm</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">NCCL_SHRINK_ABORT</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that:</p>
<ol class="arabic simple">
<li><p>Only ranks that will be part of the new communicator should call <a class="reference internal" href="../api/comms.html#c.ncclCommShrink" title="ncclCommShrink"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommShrink()</span></code></a>.</p></li>
<li><p>Ranks listed in the exclusion list should not call this function.</p></li>
<li><p>The new communicator will have ranks re-ordered to maintain contiguous numbering.</p></li>
<li><p>You can use the ncclGroupStart/ncclGroupEnd mechanism to synchronize the creation of new communicators.</p></li>
</ol>
<p>Related link: <a class="reference internal" href="../api/comms.html#c.ncclCommShrink" title="ncclCommShrink"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommShrink()</span></code></a></p>
</section>
<section id="growing-a-communicator">
<h2>Growing a communicator<a class="headerlink" href="#growing-a-communicator" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="../api/comms.html#c.ncclCommGrow" title="ncclCommGrow"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommGrow()</span></code></a> function allows you to create a new communicator by adding new ranks to an existing one.
This is useful when you need to dynamically scale up your computation by adding more GPUs or nodes to a running collective operation.</p>
<p>Growing a communicator involves coordination between existing ranks (from the parent communicator) and new ranks (joining the communicator).
The process requires a coordinator rank from the existing communicator to generate a unique identifier using <a class="reference internal" href="../api/comms.html#c.ncclCommGetUniqueId" title="ncclCommGetUniqueId"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommGetUniqueId()</span></code></a>,
which is then distributed to all new ranks through an out-of-band mechanism (e.g., MPI, sockets, or shared memory).</p>
<p>The following example demonstrates how to grow a 4-rank communicator to 8 ranks:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// Step 1: Coordinator (e.g., rank 0) generates the grow identifier</span>
<span class="n">ncclUniqueId</span><span class="w"> </span><span class="n">growId</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">myRank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">ncclResult_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncclCommGetUniqueId</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">growId</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ncclSuccess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Handle error</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Distribute growId to all new ranks using out-of-band communication</span>
<span class="w">  </span><span class="c1">// (e.g., MPI_Send, sockets, shared memory, etc.)</span>
<span class="p">}</span>

<span class="c1">// Step 2: All existing ranks call ncclCommGrow</span>
<span class="n">ncclComm_t</span><span class="w"> </span><span class="n">newcomm</span><span class="p">;</span>
<span class="n">ncclResult_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncclCommGrow</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">newcomm</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ncclSuccess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Handle error</span>
<span class="p">}</span>

<span class="c1">// Step 3: New ranks (4-7) call ncclCommGrow with the received growId</span>
<span class="n">cudaSetDevice</span><span class="p">(</span><span class="n">myDevice</span><span class="p">);</span>
<span class="n">ncclComm_t</span><span class="w"> </span><span class="n">newcomm</span><span class="p">;</span>
<span class="n">ncclResult_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncclCommGrow</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">growId</span><span class="p">,</span><span class="w"> </span><span class="n">myNewRank</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">newcomm</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="c1">// Step 4: Wait for grow operation to complete (if non-blocking)</span>
<span class="n">ncclResult_t</span><span class="w"> </span><span class="n">asyncErr</span><span class="p">;</span>
<span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncclCommGetAsyncError</span><span class="p">(</span><span class="n">newcomm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">asyncErr</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">asyncErr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ncclInProgress</span><span class="p">);</span>

<span class="c1">// Step 5: Use the new communicator for collective operations</span>
<span class="c1">// ...</span>

<span class="c1">// Step 6: Existing ranks should destroy the parent communicator</span>
<span class="n">ncclCommDestroy</span><span class="p">(</span><span class="n">comm</span><span class="p">);</span>

<span class="c1">// Step 7: When done, destroy the new communicator</span>
<span class="n">ncclCommDestroy</span><span class="p">(</span><span class="n">newcomm</span><span class="p">);</span>
</pre></div>
</div>
<p>For non-blocking grow operations with error handling:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ncclConfig_t</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NCCL_CONFIG_INITIALIZER</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">blocking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Non-blocking mode</span>

<span class="c1">// Existing ranks</span>
<span class="n">ncclComm_t</span><span class="w"> </span><span class="n">newcomm</span><span class="p">;</span>
<span class="n">ncclResult_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncclCommGrow</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">newcomm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>

<span class="c1">// Poll for completion</span>
<span class="n">ncclResult_t</span><span class="w"> </span><span class="n">asyncErr</span><span class="p">;</span>
<span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncclCommGetAsyncError</span><span class="p">(</span><span class="n">newcomm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">asyncErr</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ncclSuccess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Handle error</span>
<span class="w">    </span><span class="n">ncclCommAbort</span><span class="p">(</span><span class="n">newcomm</span><span class="p">);</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Handle timeouts or other events</span>
<span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">asyncErr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ncclInProgress</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">asyncErr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ncclSuccess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Grow completed successfully</span>
<span class="w">  </span><span class="c1">// Destroy parent communicator</span>
<span class="w">  </span><span class="n">ncclCommDestroy</span><span class="p">(</span><span class="n">comm</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Important considerations:</p>
<ol class="arabic simple">
<li><p><strong>Coordinator selection</strong>: Any rank from the existing communicator can be the coordinator. The coordinator calls <a class="reference internal" href="../api/comms.html#c.ncclCommGetUniqueId" title="ncclCommGetUniqueId"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommGetUniqueId()</span></code></a> to generate the grow identifier.</p></li>
<li><p><strong>Rank assignment</strong>: Existing ranks retain their original rank numbers in the new communicator. New ranks must be assigned ranks starting from the size of the parent communicator.</p></li>
<li><p><strong>Out-of-band communication</strong>: The grow identifier must be distributed from the coordinator to all new ranks using a communication mechanism outside of NCCL (e.g., MPI, sockets, shared files).</p></li>
<li><p><strong>Parent communicator cleanup</strong>: After the grow operation completes successfully, existing ranks should destroy the parent communicator using <a class="reference internal" href="../api/comms.html#c.ncclCommDestroy" title="ncclCommDestroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommDestroy()</span></code></a> to free resources.</p></li>
<li><p><strong>No outstanding operations</strong>: There should not be any outstanding NCCL operations on the parent communicator when calling <a class="reference internal" href="../api/comms.html#c.ncclCommGrow" title="ncclCommGrow"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommGrow()</span></code></a> to avoid potential deadlocks.</p></li>
<li><p><strong>Configuration inheritance</strong>: The new communicator inherits the configuration from the parent communicator for existing ranks. New ranks use the provided configuration or default settings.</p></li>
</ol>
<p>Related links:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../api/comms.html#c.ncclCommGrow" title="ncclCommGrow"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommGrow()</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/comms.html#c.ncclCommGetUniqueId" title="ncclCommGetUniqueId"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommGetUniqueId()</span></code></a></p></li>
</ul>
</section>
<section id="creating-more-communicators">
<h2>Creating more communicators<a class="headerlink" href="#creating-more-communicators" title="Permalink to this heading"></a></h2>
<p>The ncclCommSplit function can be used to create communicators based on an existing one. This allows to split an existing
communicator into multiple sub-partitions, duplicate an existing communicator, or even create a single communicator with
fewer ranks.</p>
<p>The ncclCommSplit function needs to be called by all ranks in the original communicator. If some ranks will not be part
of any sub-group, they still need to call ncclCommSplit with color being NCCL_SPLIT_NOCOLOR.</p>
<p>Newly created communicators will inherit the parent communicator configuration (e.g. non-blocking).
If the parent communicator operates in non-blocking mode, a ncclCommSplit operation may be stopped by calling ncclCommAbort
on the parent communicator, then on any new communicator returned. This is because a hang could happen during
operations on any of the two communicators.</p>
<p>The following code duplicates an existing communicator:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">rank</span><span class="p">;</span>
<span class="n">ncclCommUserRank</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rank</span><span class="p">);</span>
<span class="n">ncclCommSplit</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">newcomm</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</pre></div>
</div>
<p>This splits a communicator in two halves:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="n">nranks</span><span class="p">;</span>
<span class="n">ncclCommUserRank</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rank</span><span class="p">);</span>
<span class="n">ncclCommCount</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nranks</span><span class="p">);</span>
<span class="n">ncclCommSplit</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="o">/</span><span class="p">(</span><span class="n">nranks</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">rank</span><span class="o">%</span><span class="p">(</span><span class="n">nranks</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">newcomm</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</pre></div>
</div>
<p>This creates a communicator with only the first 2 ranks:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">rank</span><span class="p">;</span>
<span class="n">ncclCommUserRank</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rank</span><span class="p">);</span>
<span class="n">ncclCommSplit</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="o">&lt;</span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">NCCL_SPLIT_NOCOLOR</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">newcomm</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</pre></div>
</div>
<p>Related links:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../api/comms.html#c.ncclCommSplit" title="ncclCommSplit"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommSplit()</span></code></a></p></li>
</ul>
</div></blockquote>
</section>
<section id="using-multiple-nccl-communicators-concurrently">
<span id="multi-thread-concurrent-usage"></span><h2>Using multiple NCCL communicators concurrently<a class="headerlink" href="#using-multiple-nccl-communicators-concurrently" title="Permalink to this heading"></a></h2>
<p>Prior to NCCL 2.26, using multiple NCCL communicators per-device required serializing the order of all communication operations (via CUDA stream dependencies or synchronization) into a consistent total global order otherwise deadlocks could ensue. As of 2.26, NCCL introduces <a class="reference internal" href="../env.html#nccl-launch-order-implicit"><span class="std std-ref">NCCL_LAUNCH_ORDER_IMPLICIT</span></a> which when enabled implicitly creates this order dynamically by following the order operations are issued from the host. Thus to remain deadlock free, users must ensure the order of host-side launches matches for all devices. This is most easily accomplished by using a determinstic order issued from a single host thread per-device. For example:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ncclAllReduce</span><span class="p">(...,</span><span class="w"> </span><span class="n">comm1</span><span class="p">,</span><span class="w"> </span><span class="n">stream1</span><span class="p">);</span><span class="w"> </span><span class="c1">// all ranks do this first</span>
<span class="n">ncclAllReduce</span><span class="p">(...,</span><span class="w"> </span><span class="n">comm2</span><span class="p">,</span><span class="w"> </span><span class="n">stream2</span><span class="p">);</span><span class="w"> </span><span class="c1">// and this second</span>
</pre></div>
</div>
<p>When NCCL is captured in a CUDA graph the same rules apply to both capture time and launch time. At capture time this means NCCL calls in the same graph must be captured in the same order:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// both stream1 and stream2 are capturing in the same graph</span>
<span class="n">ncclAllReduce</span><span class="p">(...,</span><span class="w"> </span><span class="n">comm1</span><span class="p">,</span><span class="w"> </span><span class="n">stream1</span><span class="p">);</span><span class="w"> </span><span class="c1">// all ranks do this first</span>
<span class="n">ncclAllReduce</span><span class="p">(...,</span><span class="w"> </span><span class="n">comm2</span><span class="p">,</span><span class="w"> </span><span class="n">stream2</span><span class="p">);</span><span class="w"> </span><span class="c1">// and this second</span>
</pre></div>
</div>
<p>And at graph launch time different graphs must be launched in a globally consistent order:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">cudaGraphLaunch</span><span class="p">(</span><span class="n">graph1</span><span class="p">,</span><span class="w"> </span><span class="n">stream1</span><span class="p">);</span><span class="w"> </span><span class="c1">// all ranks do this first</span>
<span class="n">cudaGraphLaunch</span><span class="p">(</span><span class="n">graph2</span><span class="p">,</span><span class="w"> </span><span class="n">stream2</span><span class="p">);</span><span class="w"> </span><span class="c1">// and this second</span>
</pre></div>
</div>
<p>When running on CUDA 12.3 or later, the implicit ordering of the operations is created using CUDA launch completion events which permits parallel execution of the two communicators kernels.</p>
</section>
<section id="finalizing-a-communicator">
<h2>Finalizing a communicator<a class="headerlink" href="#finalizing-a-communicator" title="Permalink to this heading"></a></h2>
<p>ncclCommFinalize will transition a communicator from the <em>ncclSuccess</em> state to the <em>ncclInProgress</em> state, start
completing all operations in the background and synchronize with other ranks which may be using resources for their
communications with other ranks.
All uncompleted operations and network-related resources associated to a communicator will be flushed and freed with
ncclCommFinalize.
Once all NCCL operations are complete, the communicator will transition to the <em>ncclSuccess</em> state. Users can
query that state with ncclCommGetAsyncError.
If a communicator is marked as nonblocking, this operation is nonblocking; otherwise, it is blocking.</p>
<p>Related link: <a class="reference internal" href="../api/comms.html#c.ncclCommFinalize" title="ncclCommFinalize"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommFinalize()</span></code></a></p>
</section>
<section id="destroying-a-communicator">
<h2>Destroying a communicator<a class="headerlink" href="#destroying-a-communicator" title="Permalink to this heading"></a></h2>
<p>Once a communicator has been finalized, the next step is to free all resources, including the communicator itself.
Local resources associated to a communicator can be destroyed with ncclCommDestroy. If the state of a communicator
is <em>ncclSuccess</em> when calling ncclCommDestroy, the call is guaranteed to be nonblocking; otherwise
ncclCommDestroy might block.
In all cases, ncclCommDestroy call will free the resources of the communicator and return, and
the communicator should no longer be accessed after ncclCommDestroy returns.</p>
<p>Related link: <a class="reference internal" href="../api/comms.html#c.ncclCommDestroy" title="ncclCommDestroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommDestroy()</span></code></a></p>
</section>
</section>
<section id="error-handling-and-communicator-abort">
<h1>Error handling and communicator abort<a class="headerlink" href="#error-handling-and-communicator-abort" title="Permalink to this heading"></a></h1>
<p>All NCCL calls return a NCCL error code which is sumarized in the table below. If a NCCL call returns an error code
different from ncclSuccess and ncclInternalError, and if NCCL_DEBUG is set to WARN, NCCL will print a human-readable
message explaining what happened.
If NCCL_DEBUG is set to INFO, NCCL will also print the call stack which led to the error.
This message is intended to help the user fix the problem.</p>
<p>The table below summarizes how different errors should be understood and handled. Each case is explained in details
in the following sections.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">NCCL Errors</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 50.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
<col style="width: 10.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Error</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Resolution</p></th>
<th class="head"><p>Error handling</p></th>
<th class="head"><p>Group behavior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ncclSuccess</p></td>
<td><p>No error</p></td>
<td><p>None</p></td>
<td><p>None</p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>ncclUnhandledCudaError</p></td>
<td><p>Error during a CUDA call (1)</p></td>
<td><p>CUDA configuration / usage (1)</p></td>
<td><p>Communicator abort (5)</p></td>
<td><p>Global (6)</p></td>
</tr>
<tr class="row-even"><td><p>ncclSystemError</p></td>
<td><p>Error during a system call (1)</p></td>
<td><p>System configuration / usage (1)</p></td>
<td><p>Communicator abort (5)</p></td>
<td><p>Global (6)</p></td>
</tr>
<tr class="row-odd"><td><p>ncclInternalError</p></td>
<td><p>Error inside NCCL (2)</p></td>
<td><p>Fix in NCCL (2)</p></td>
<td><p>Communicator abort (5)</p></td>
<td><p>Global (6)</p></td>
</tr>
<tr class="row-even"><td><p>ncclInvalidArgument</p></td>
<td><p>An argument to a NCCL call is invalid (3)</p></td>
<td><p>Fix in the application (3)</p></td>
<td><p>None (3)</p></td>
<td><p>Individual (3)</p></td>
</tr>
<tr class="row-odd"><td><p>ncclInvalidUsage</p></td>
<td><p>The usage of NCCL calls is invalid (4)</p></td>
<td><p>Fix in the application (4)</p></td>
<td><p>Communicator abort (5)</p></td>
<td><p>Global (6)</p></td>
</tr>
<tr class="row-even"><td><p>ncclInProgress</p></td>
<td><p>The NCCL call is still in progress</p></td>
<td><p>Poll for completion using ncclCommGetAsyncError</p></td>
<td><p>None</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
<p>(1) ncclUnhandledCudaError and ncclSystemError indicate that a call NCCL made to an external component failed,
which caused the NCCL operation to fail. The error message should explain which component the user should look
at and try to fix, potentially with the help of the administrators of the system.</p>
<p>(2) ncclInternalError denotes a NCCL bug. It might not report a message with NCCL_DEBUG=WARN since it requires a
fix in the NCCL source code. NCCL_DEBUG=INFO will print the back trace which led to the error.</p>
<p>(3) ncclInvalidArgument indicates an argument value is incorrect, like a NULL pointer or an out-of-bounds value.
When this error is returned, the NCCL call had no effect. The group state remains unchanged, the communicator is
still functioning normally. The application can call ncclCommAbort or continue as if the call did not happen.
This error will be returned immediately for a call happening within a group and applies to that specific NCCL
call. It will not be returned by ncclGroupEnd since ncclGroupEnd takes no argument.</p>
<p>(4) ncclInvalidUsage is returned when a dynamic condition causes a failure, which denotes an incorrect usage of
the NCCL API.</p>
<p>(5) These errors are fatal for the communicator. To recover, the application needs to call ncclCommAbort on the
communicator and re-create it.</p>
<p>(6) Dynamic errors for operations within a group are always reported by ncclGroupEnd and apply to all operations
within the group, which may or may not have completed. The application must call ncclCommAbort on all communicators
within the group.</p>
<section id="asynchronous-errors-and-error-handling">
<h2>Asynchronous errors and error handling<a class="headerlink" href="#asynchronous-errors-and-error-handling" title="Permalink to this heading"></a></h2>
<p>Some communication errors, and in particular network errors, are reported through the ncclCommGetAsyncError function.
Operations experiencing an asynchronous error will usually not progress and never complete. When an asynchronous error
happens, the operation should be aborted and the communicator destroyed using ncclCommAbort.
When waiting for NCCL operations to complete, applications should call ncclCommGetAsyncError and destroy the
communicator when an error happens.</p>
<p>The following code shows how to wait on NCCL operations and poll for asynchronous errors, instead of using
cudaStreamSynchronize.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">ncclStreamSynchronize</span><span class="p">(</span><span class="n">cudaStream_t</span><span class="w"> </span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="n">ncclComm_t</span><span class="w"> </span><span class="n">comm</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">cudaError_t</span><span class="w"> </span><span class="n">cudaErr</span><span class="p">;</span>
<span class="w">  </span><span class="n">ncclResult_t</span><span class="w"> </span><span class="n">ncclErr</span><span class="p">,</span><span class="w"> </span><span class="n">ncclAsyncErr</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">cudaErr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cudaStreamQuery</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cudaErr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cudaSuccess</span><span class="p">)</span>
<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cudaErr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">cudaErrorNotReady</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CUDA Error : cudaStreamQuery returned %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cudaErr</span><span class="p">);</span>
<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="n">ncclErr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncclCommGetAsyncError</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ncclAsyncErr</span><span class="p">);</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ncclErr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ncclSuccess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;NCCL Error : ncclCommGetAsyncError returned %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ncclErr</span><span class="p">);</span>
<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ncclAsyncErr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ncclSuccess</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="c1">// An asynchronous error happened. Stop the operation and destroy</span>
<span class="w">     </span><span class="c1">// the communicator</span>
<span class="w">     </span><span class="n">ncclErr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncclCommAbort</span><span class="p">(</span><span class="n">comm</span><span class="p">);</span>
<span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ncclErr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ncclSuccess</span><span class="p">)</span>
<span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;NCCL Error : ncclCommDestroy returned %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ncclErr</span><span class="p">);</span>
<span class="w">     </span><span class="c1">// Caller may abort or try to create a new communicator.</span>
<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c1">// We might want to let other threads (including NCCL threads) use the CPU.</span>
<span class="w">   </span><span class="n">sched_yield</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Related links:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../api/comms.html#c.ncclCommGetAsyncError" title="ncclCommGetAsyncError"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommGetAsyncError()</span></code></a></p></li>
<li><p><a class="reference internal" href="../api/comms.html#c.ncclCommAbort" title="ncclCommAbort"><code class="xref c c-func docutils literal notranslate"><span class="pre">ncclCommAbort()</span></code></a></p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="fault-tolerance">
<span id="ft"></span><h1>Fault Tolerance<a class="headerlink" href="#fault-tolerance" title="Permalink to this heading"></a></h1>
<p>NCCL provides a set of features to allow applications to recover from fatal errors such as a network failure,
a node failure, or a process failure. When such an error happens, the application should be able to call <em>ncclCommAbort</em>
on the communicator to free all resources, then create a new communicator to continue.</p>
<p>For more advanced recovery, the <em>ncclCommShrink</em> function with <em>NCCL_SHRINK_ABORT</em> can be used to create a new communicator
by removing failed ranks from the existing communicator while safely handling in-progress operations. This approach is
particularly useful in distributed environments where only some ranks have failed.</p>
<p>In order to abort NCCL communicators safely, NCCL requires applications to set communicators as nonblocking and make sure
no thread is calling any NCCL operations while calling <em>ncclCommAbort</em>. After nonblocking is set, all NCCL calls
(except <em>ncclCommDestroy/Abort</em>) become nonblocking so that <em>ncclCommAbort</em> can be called at any point, during initialization,
communication or finalizing the communicator. If NCCL communicators are set blocking, the thread can possibly get stuck inside
NCCL calls due to network errors; in this case, NCCL communicators might hang forever.</p>
<p>To correctly abort, when any rank in a communicator fails (e.g., due to a segmentation fault), all other ranks need to
call <em>ncclCommAbort</em> to abort their own NCCL communicator.
Users can implement methods to decide when and whether to abort the communicators and restart the NCCL operation.
Here is an example showing how to initialize and split a communicator in a non-blocking manner, allowing for an abort at any point:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="n">globalFlag</span><span class="p">;</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">abortFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="n">ncclConfig_t</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NCCL_CONFIG_INITIALIZER</span><span class="p">;</span>
<span class="cm">/* set communicator as nonblocking */</span>
<span class="n">config</span><span class="p">.</span><span class="n">blocking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommInitRankConfig</span><span class="p">(</span><span class="o">&amp;</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">nRanks</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">myRank</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">));</span>
<span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommGetAsyncError</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state</span><span class="p">));</span>
<span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ncclInProgress</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">checkTimeout</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">checkTimeout</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ncclSuccess</span><span class="p">)</span><span class="w"> </span><span class="n">abortFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="cm">/* sync abortFlag among all healthy ranks. */</span>
<span class="n">reportErrorGlobally</span><span class="p">(</span><span class="n">abortFlag</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">globalFlag</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">globalFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="cm">/* time is out or initialization failed: every rank needs to abort and restart. */</span>
<span class="w">  </span><span class="n">ncclCommAbort</span><span class="p">(</span><span class="n">comm</span><span class="p">);</span>
<span class="w">  </span><span class="cm">/* restart NCCL; this is a user implemented function, it might include</span>
<span class="cm">   * resource cleanup and ncclCommInitRankConfig() to create new communicators. */</span>
<span class="w">  </span><span class="n">restartNCCL</span><span class="p">(</span><span class="o">&amp;</span><span class="n">comm</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* nonblocking communicator split. */</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommSplit</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">childComm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">));</span>
<span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommGetAsyncError</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state</span><span class="p">));</span>
<span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ncclInProgress</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">checkTimeout</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">checkTimeout</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ncclSuccess</span><span class="p">)</span><span class="w"> </span><span class="n">abortFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="cm">/* sync abortFlag among all healthy ranks. */</span>
<span class="n">reportErrorGlobally</span><span class="p">(</span><span class="n">abortFlag</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">globalFlag</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">globalFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">ncclCommAbort</span><span class="p">(</span><span class="n">comm</span><span class="p">);</span>
<span class="w">  </span><span class="cm">/* if chilComm is not NCCL_COMM_NULL, user should abort child communicator</span>
<span class="cm">   * here as well for resource reclamation. */</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">childComm</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NCCL_COMM_NULL</span><span class="p">)</span><span class="w"> </span><span class="n">ncclCommAbort</span><span class="p">(</span><span class="n">childComm</span><span class="p">);</span>
<span class="w">  </span><span class="n">restartNCCL</span><span class="p">(</span><span class="o">&amp;</span><span class="n">comm</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/* application workload */</span>
</pre></div>
</div>
<p>The <em>checkTimeout</em> function needs to be provided by users to determine what is the longest time the application should wait for
NCCL initialization; likewise, users can apply other methods to detect errors besides a timeout function. Similar methods can be applied
to NCCL finalization as well.</p>
</section>
<section id="quality-of-service">
<h1>Quality of Service<a class="headerlink" href="#quality-of-service" title="Permalink to this heading"></a></h1>
<p>Applications which overlap communication may benefit from network Quality of
Service (QoS) features. NCCL allows an application to assign a traffic class (TC) to
each communicator to identify the communication requirements of the
communicator. All network operations on a communicator will use the assigned
TC.</p>
<p>The meaning of TC is specific to the network plugin in use by the communicator
(e.g. IB networks use service level, RoCE networks use type of service). TCs are defined
by the system configuration. Applications must understand the TCs available on
a system and their relative behavior in order to use them effectively.</p>
<p>TC is specified during communicator creation using <a class="reference internal" href="../api/types.html#ncclconfig"><span class="std std-ref">ncclConfig_t</span></a>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">ncclConfig_t</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NCCL_CONFIG_INITIALIZER</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">trafficClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">CHECK</span><span class="p">(</span><span class="n">ncclCommInitRankConfig</span><span class="p">(</span><span class="o">&amp;</span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="n">nranks</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">));</span>
</pre></div>
</div>
<p>Infiniband networks support QoS through the use of Service Levels (SL). Each IB SL
is mapped to Virtual Lane (VL), which defines the relative priority of traffic. SL
behavior is defined within the subnet manager, such as OpenSM. Refer to subnet
manager documentation for more detail. An example configuration is shown below.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">qos_max_vls</span><span class="w"> </span><span class="mi">2</span>
<span class="n">qos_high_limit</span><span class="w"> </span><span class="mi">255</span>
<span class="n">qos_vlarb_high</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span>
<span class="n">qos_vlarb_low</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span>
<span class="n">qos_sl2vl</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span>

<span class="n">max_op_vls</span><span class="w"> </span><span class="mi">2</span>
<span class="p">....</span>
</pre></div>
</div>
<p>The example defines one low priority and one high priority VL which
are mapped to SL 0 and 1, respectively. The high priority SL will be
given a larger share of network bandwidth at each port. In NCCL, the
communicators traffic class corresponds to the SL on IB networks. Using
this configuration, applications can assign TC 0 to low-priority communicators
and TC 1 to high-priority ones.</p>
<p>On RoCE networks, the NCCL communicator trafficClass is interpreted as an IP
Type of Service (ToS). Refer to network management tools to understand how to
configure QoS for a given workload.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../usage.html" class="btn btn-neutral float-left" title="Using NCCL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="collectives.html" class="btn btn-neutral float-right" title="Collective Operations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2025, NVIDIA Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  
  <style>
  a:link, a:visited {
    color: #76b900;
  }
  a:hover {
    color: #8c0;
  }
  .rst-content dl:not(.docutils) dt {
    background: rgba(118, 185, 0, 0.1) !important;
    color: rgba(59,93,0,1) !important;
    border-top: solid 3px rgba(59,93,0,1) !important;
  }
  </style>
  <script type="text/javascript">_satellite.pageBottom();</script>


</body>
</html>