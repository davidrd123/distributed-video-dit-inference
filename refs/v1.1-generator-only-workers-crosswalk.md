# v1.1 “Generator-only Workers” — Crosswalk (Scope notes ↔ Library operator manuals)

Date: 2026-02-22  
Status: First pass (reviewable)

## Purpose

When implementing or reviewing **TP v1.1 generator-only workers** (and the PP follow-ons it enables), the slow part is re-deriving the “ship checklist” from several long notes.

This doc maps:
- `scope-drd/notes/FA4/h200/tp/v1.1-generator-only-workers.md` sections → **which library topics to reread** (operator manuals), and
- where to go in `scope-drd/notes/FA4/h200/tp/` for the project-local ground truth.

Companion plan doc: `refs/tp-pp-operator-manual-packaging.md`.

## What to treat as source of truth

- **Design + invariants**: `scope-drd/notes/FA4/h200/tp/v1.1-generator-only-workers.md`
- **Failure taxonomy + guardrails**: `scope-drd/notes/FA4/h200/tp/explainers/06-failure-modes.md`
- **Control-plane mechanics (TP)**: `scope-drd/notes/FA4/h200/tp/explainers/03-broadcast-envelope.md`
- **v0 “what’s locked and why”**: `scope-drd/notes/FA4/h200/tp/explainers/07-v0-contract.md`
- **Deadlock audit for v1.1c**: `scope-drd/notes/FA4/h200/tp/5pro/10-v11-correctness-deadlock-audit/response.md`
- **PP follow-on (rank0-out-of-mesh) execution**: `scope-drd/notes/FA4/h200/tp/pp-next-steps.md`, `scope-drd/notes/FA4/h200/tp/pp-topology-pilot-plan.md`, `scope-drd/notes/FA4/h200/tp/pp0-bringup-runbook.md`

## Operator-manual topics (the “ship checklists”)

These are the library docs that should become 1-page enforceable checklists (contract + tripwires + break-it tests + instrumentation):

- Control-plane contract: `refs/topics/20-message-framing-versioning.md`
- Deadlocks (ordering, groups, stranding): `refs/topics/02-deadlock-patterns.md`
- Shutdown/draining: `refs/topics/03-graceful-shutdown.md`
- Backpressure/overlap (PP): `refs/topics/19-producer-consumer-backpressure.md`
- Idempotency/replay primitives (epochs, drops): `refs/topics/21-idempotency-and-replay.md`
- Determinism/drift detection: `refs/topics/04-determinism-across-ranks.md`
- KV-cache lifecycle *(still needs drafting as operator manual)*: `refs/topics/22-kv-cache-management.md`

Minimal “physics cards” to reread when you need authoritative backing:
- `refs/resources/nccl-user-guide.md`
- `refs/resources/pytorch-cuda-semantics.md`
- `refs/resources/funcol-rfc-93173.md`
- `refs/resources/dynamo-deep-dive.md`

## Crosswalk: v1.1 scaffold → what to reread

| v1.1 scaffold section | Implementation / review question | Scope notes to consult | Library operator-manual topics |
|---|---|---|---|
| **Why v1.1 exists** (memory/startup/topology) | Are we optimizing the right thing (structural foundation vs FPS)? What’s the ROI gate? | `scope-drd/notes/FA4/h200/tp/bringup-run-log.md` (worker memory), `scope-drd/notes/FA4/h200/tp/session-state.md` | `refs/topics/16-roofline-model.md` (perf regime framing), `refs/topics/15-pipeline-scheduling-theory.md` (in-flight depth intuition) |
| **Hard constraints** (identical inputs, lockstep, crash>hang) | What *must* be identical across ranks and why do failures become hang vs Franken-model? | `scope-drd/notes/FA4/h200/tp/explainers/06-failure-modes.md`, `scope-drd/notes/FA4/h200/tp/explainers/07-v0-contract.md` | `refs/topics/02-deadlock-patterns.md`, `refs/topics/04-determinism-across-ranks.md`, `refs/topics/03-graceful-shutdown.md` |
| **Phase A/B/C split** | What moves to rank0 vs what stays lockstep? What state must remain consistent? | `scope-drd/notes/FA4/h200/tp/v1.1-generator-only-workers.md` (phases), `scope-drd/notes/FA4/h200/tp/async-decode-overlap-scoping.md` (coupling), `scope-drd/notes/FA4/h200/tp/pp-topology-pilot-plan.md` (Stage0/Stage1 split) | `refs/topics/22-kv-cache-management.md`, `refs/topics/19-producer-consumer-backpressure.md` |
| **Control-plane shape** (`tp_plan`, `tp_envelope_version`, action choice) | How do we version and dispatch the worker path without introducing conditional-collective deadlocks? | `scope-drd/notes/FA4/h200/tp/explainers/03-broadcast-envelope.md`, `scope-drd/notes/FA4/h200/tp/5pro/10-v11-correctness-deadlock-audit/response.md` (FM-01..FM-04) | `refs/topics/20-message-framing-versioning.md`, `refs/topics/02-deadlock-patterns.md` |
| **What must cross rank0 → workers** (“generator envelope”) | What is required every chunk vs only on updates? How do we ensure “no fallback” under v1 plan? | `scope-drd/notes/FA4/h200/tp/v1.1-generator-only-workers.md` (required fields), `scope-drd/notes/FA4/h200/tp/explainers/03-broadcast-envelope.md` (tensor_specs) | `refs/topics/20-message-framing-versioning.md`, `refs/topics/04-determinism-across-ranks.md`, `refs/topics/22-kv-cache-management.md` |
| **Risk-ranked milestones (v1.1a/b/c)** | What is the minimum wedge that reduces coupling risk without new hang surfaces? | `scope-drd/notes/FA4/h200/tp/v1.1-generator-only-workers.md` (v1.1a/b/c), `scope-drd/notes/FA4/h200/tp/bringup-run-log.md` (v1.1 matrix) | `refs/topics/22-kv-cache-management.md` (recompute coupling), `refs/topics/20-message-framing-versioning.md` |
| **Invariants / tripwires** | Where do we assert call-count, plan parity, dtype support, monotonic IDs, “no nested tensors”? | `scope-drd/notes/FA4/h200/tp/5pro/10-v11-correctness-deadlock-audit/response.md`, `scope-drd/notes/FA4/h200/tp/explainers/06-failure-modes.md` | `refs/topics/02-deadlock-patterns.md`, `refs/topics/20-message-framing-versioning.md`, `refs/topics/04-determinism-across-ranks.md` |
| **Safeguards checklist (crash > hang)** | How do we guarantee “fail before broadcast/collectives,” and what watchdog/timeouts apply? | `scope-drd/notes/FA4/h200/tp/explainers/06-failure-modes.md` (Q7), `scope-drd/notes/FA4/h200/tp/pp-next-steps.md` (A1 anti-stranding) | `refs/topics/03-graceful-shutdown.md`, `refs/topics/20-message-framing-versioning.md` |
| **How we’ll measure progress** | What metrics prove success (memory/startup), and what counters catch regressions (graph breaks, unique graphs)? | `scope-drd/notes/FA4/h200/tp/bringup-run-log.md`, `scope-drd/notes/FA4/h200/tp/research-program.md` | `refs/topics/17-reading-profiler-traces.md`, `refs/topics/18-bandwidth-accounting.md`, `refs/topics/16-roofline-model.md` |
| **Flags / rollout** | Which flags must be env-parity-checked? Which flags can change call-count/collectives? | `scope-drd/notes/FA4/h200/tp/explainers/07-v0-contract.md` (parity principle), `scope-drd/notes/FA4/h200/tp/5pro/10-v11-correctness-deadlock-audit/response.md` (FM-03) | `refs/topics/02-deadlock-patterns.md`, `refs/topics/20-message-framing-versioning.md` |
| **Implementation touchpoints** | Where are the high-risk code edges (override lifetime, in-block broadcasts, cache reset decisions)? | `scope-drd/notes/FA4/h200/tp/v1.1-generator-only-workers.md` (touchpoints), audit FM list (`scope-drd/notes/FA4/h200/tp/5pro/10-v11-correctness-deadlock-audit/response.md`) | `refs/topics/22-kv-cache-management.md`, `refs/topics/20-message-framing-versioning.md`, `refs/topics/02-deadlock-patterns.md` |

## Minimal break-it tests to standardize (shared across v1.1 + PP)

If we only standardize a few intentional failures, make them these:

1) **Anti-stranding test**: force meta serialization failure (`pickle.dumps`/stable JSON) and verify the sender fails *before* sending an `INFER` header (peer does not block).  
   Topics: `refs/topics/20-message-framing-versioning.md`, `refs/topics/02-deadlock-patterns.md`

2) **Call-count mismatch**: force `expected_generator_calls ± 1` and verify fail-fast before hanging.  
   Topics: `refs/topics/02-deadlock-patterns.md`, `refs/topics/22-kv-cache-management.md`

3) **Per-rank flag mismatch**: gate a collective behind a flag not env-parity-checked and observe hang; then add parity check and confirm deterministic behavior.  
   Topics: `refs/topics/02-deadlock-patterns.md`, `refs/topics/04-determinism-across-ranks.md`

4) **Stale-epoch result** (PP): delay a result across a hard cut and verify it is dropped by `cache_epoch` mismatch.  
   Topics: `refs/topics/21-idempotency-and-replay.md`, `refs/topics/19-producer-consumer-backpressure.md`

## TODOs (to make this crosswalk “complete”)

- Draft `refs/topics/22-kv-cache-management.md` as a true operator manual (contract + tripwires + break-it tests + instrumentation).
- Standardize `refs/topics/04-determinism-across-ranks.md` to the operator-manual template (contract + tripwires + break-it tests + instrumentation).
- Convert + condense canonical basics so operator topics can cite them:
  - `sources/pytorch-distributed-api/raw/page.html` → Tier 2/3
  - `sources/cuda-async-execution/raw/page.html` → Tier 2/3
